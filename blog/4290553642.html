<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>What the f*ck Python! | EmoryHuang's Blog</title><meta name="keywords" content="Python"><meta name="author" content="EmoryHuang"><meta name="copyright" content="EmoryHuang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Python,是一个设计优美的解释型高级语言,它提供了很多能让程序员感到舒适的功能特性.但有的时候,Python的一些输出结果对于初学者来说似乎并不是那么一目了然.">
<meta property="og:type" content="article">
<meta property="og:title" content="What the f*ck Python!">
<meta property="og:url" content="https://emoryhuang.cn/blog/4290553642.html">
<meta property="og:site_name" content="EmoryHuang&#39;s Blog">
<meta property="og:description" content="Python,是一个设计优美的解释型高级语言,它提供了很多能让程序员感到舒适的功能特性.但有的时候,Python的一些输出结果对于初学者来说似乎并不是那么一目了然.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://static.emoryhuang.cn/webp/4290553642-banner.webp">
<meta property="article:published_time" content="2021-08-20T06:50:17.000Z">
<meta property="article:modified_time" content="2022-08-19T04:59:02.660Z">
<meta property="article:author" content="EmoryHuang">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://static.emoryhuang.cn/webp/4290553642-banner.webp"><link rel="shortcut icon" href="https://static.emoryhuang.cn/img/emoryhuang-favicon.ico"><link rel="canonical" href="https://emoryhuang.cn/blog/4290553642"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="G-8PVDZZ1XD2"/><meta name="baidu-site-verification" content="c329cbbc3bebfd543905d12a396ae46f"/><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/favicon-16x16.png"/><link rel="mask-icon" href="/img/siteicon/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4deb492e49dccb8704491045ae2bfb05";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8PVDZZ1XD2"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-8PVDZZ1XD2');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"ED239XGK05","apiKey":"b13ba7fa60a0bb24a8c61d428d419da2","indexName":"EmoryHuang","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":30,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: EmoryHuang","link":"链接: ","source":"来源: EmoryHuang's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'What the f*ck Python!',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-19 12:59:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://static.emoryhuang.cn/js&css/cursor.css"><link rel="stylesheet" href="https://static.emoryhuang.cn/js&css/scroll.css"><link rel="stylesheet" href="https://static.emoryhuang.cn/js&css/fix_pjax.js"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="EmoryHuang's Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/img/emoryhuang-avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">122</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">103</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://home.emoryhuang.cn"><i class="fa-fw fas fa-location-arrow"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 博客</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/chat/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw far fa-bookmark"></i><span> 常用工具</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://latex.emoryhuang.cn"><i class="fa-fw fas fa-square-root-variable"></i><span> LaTeX-Math</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-edit"></i><span> 网站更新</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://status.emoryhuang.cn"><i class="fa-fw fas fa-chart-line"></i><span> 状态监控</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://static.emoryhuang.cn/webp/4290553642-banner.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">EmoryHuang's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://home.emoryhuang.cn"><i class="fa-fw fas fa-location-arrow"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 博客</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/chat/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw far fa-bookmark"></i><span> 常用工具</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://latex.emoryhuang.cn"><i class="fa-fw fas fa-square-root-variable"></i><span> LaTeX-Math</span></a></li><li><a class="site-page child" href="/update/"><i class="fa-fw fas fa-edit"></i><span> 网站更新</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://status.emoryhuang.cn"><i class="fa-fw fas fa-chart-line"></i><span> 状态监控</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">What the f*ck Python!</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-20T06:50:17.000Z" title="发表于 2021-08-20 14:50:17">2021-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-19T04:59:02.660Z" title="更新于 2022-08-19 12:59:02">2022-08-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%88%AC%E5%9D%91/">爬坑</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>62分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="What the f*ck Python!"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="note info flat"><p>原文地址：<a target="_blank" rel="noopener" href="https://github.com/leisurelicht/wtfpython-cn">https://github.com/leisurelicht/wtfpython-cn</a></p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython">https://github.com/satwikkansal/wtfpython</a></p>
</div>
<h1>What the f*ck Python!</h1>
<h2 id="前言-33">前言</h2>
<p align="center">一些有趣且鲜为人知的 Python 特性.</p>
<p>Python, 是一个设计优美的解释型高级语言, 它提供了很多能让程序员感到舒适的功能特性. 但有的时候, Python 的一些输出结果对于初学者来说似乎并不是那么一目了然.</p>
<p>这个有趣的项目意在收集 Python 中那些难以理解和反人类直觉的例子以及鲜为人知的功能特性, 并尝试讨论这些现象背后真正的原理!</p>
<p>虽然下面的有些例子并不一定会让你觉得 WTFs, 但它们依然有可能会告诉你一些你所不知道的 Python 有趣特性. 我觉得这是一种学习编程语言内部原理的好办法, 而且我相信你也会从中获得乐趣!</p>
<p>如果您是一位经验比较丰富的 Python 程序员, 你可以尝试挑战看是否能一次就找到例子的正确答案. 你可能对其中的一些例子已经比较熟悉了, 那这也许能唤起你当年踩这些坑时的甜蜜回忆 😅</p>
<p>PS: 如果你不是第一次读了, 你可以在<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/releases/">这里</a>获取变动内容.</p>
<p>那么, 让我们开始吧…</p>
<h1>Structure of the Examples/示例结构</h1>
<p>所有示例的结构都如下所示:</p>
<blockquote>
<h3 id="一个精选的标题">&gt; 一个精选的标题 *</h3>
<p>标题末尾的星号表示该示例在第一版中不存在，是最近添加的.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 准备代码.</span></span><br><span class="line"><span class="comment"># 释放魔法...</span></span><br></pre></td></tr></table></figure>
<p><strong>Output (Python version):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>触发语句</span><br><span class="line">出乎意料的输出结果</span><br></pre></td></tr></table></figure>
<p>(可选): 对意外输出结果的简短描述.</p>
<h4 id="💡-说明">💡 说明:</h4>
<ul>
<li>简要说明发生了什么以及为什么会发生.<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如有必要, 举例说明</span><br></pre></td></tr></table></figure>
<strong>Output:</strong><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>触发语句 <span class="comment"># 一些让魔法变得容易理解的例子</span></span><br><span class="line"><span class="comment"># 一些正常的输入</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><strong>注意:</strong> 所有的示例都在 Python 3.5.2 版本的交互解释器上测试过, 如果不特别说明应该适用于所有 Python 版本.</p>
<h1>Usage/用法</h1>
<p>我个人建议, 最好依次阅读下面的示例, 并对每个示例:</p>
<ul>
<li>仔细阅读设置例子最开始的代码. 如果您是一位经验丰富的 Python 程序员, 那么大多数时候您都能成功预期到后面的结果.</li>
<li>阅读输出结果,
<ul>
<li>确认结果是否如你所料.</li>
<li>确认你是否知道这背后的原理.
<ul>
<li>如果不知道, 深呼吸然后阅读说明 (如果你还是看不明白, 别沉默! 可以在<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfPython">这</a>提个 issue).</li>
<li>如果知道, 给自己点奖励, 然后去看下一个例子.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>PS: 你也可以在命令行阅读 WTFpython. 我们有 pypi 包 和 npm 包(支持代码高亮).(译: 这两个都是英文版的)</p>
<p>安装 npm 包 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/wtfpython"><code>wtfpython</code></a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g wtfpython</span><br></pre></td></tr></table></figure>
<p>或者, 安装 pypi 包 <a target="_blank" rel="noopener" href="https://pypi.python.org/pypi/wtfpython"><code>wtfpython</code></a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install wtfpython -U</span><br></pre></td></tr></table></figure>
<p>现在, 在命令行中运行 <code>wtfpython</code>, 你就可以开始浏览了.</p>
<hr>
<h1>👀 Examples/示例</h1>
<h2 id="Section-Strain-your-brain-大脑运动">Section: Strain your brain!/大脑运动!</h2>
<h3 id="Strings-can-be-tricky-sometimes-微妙的字符串">&gt; Strings can be tricky sometimes/微妙的字符串 *</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&quot;some_string&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(a)</span><br><span class="line"><span class="number">140420665652016</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(<span class="string">&quot;some&quot;</span> + <span class="string">&quot;_&quot;</span> + <span class="string">&quot;string&quot;</span>) <span class="comment"># 注意两个的id值是相同的.</span></span><br><span class="line"><span class="number">140420665652016</span></span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&quot;wtf&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">&quot;wtf&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&quot;wtf!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">&quot;wtf!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b = <span class="string">&quot;wtf!&quot;</span>, <span class="string">&quot;wtf!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">True</span> <span class="comment"># 3.7 版本返回结果为 False.</span></span><br></pre></td></tr></table></figure>
<p>3.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;a&#x27;</span> * <span class="number">20</span> <span class="keyword">is</span> <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaa&#x27;</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;a&#x27;</span> * <span class="number">21</span> <span class="keyword">is</span> <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaa&#x27;</span></span><br><span class="line"><span class="literal">False</span> <span class="comment"># 3.7 版本返回结果为 True</span></span><br></pre></td></tr></table></figure>
<p>很好理解, 对吧?</p>
<h4 id="💡-说明-2">💡 说明:</h4>
<ul>
<li>
<p>这些行为是由于 Cpython 在编译优化时, 某些情况下会尝试使用已经存在的不可变对象而不是每次都创建一个新对象. (这种行为被称作字符串的驻留[string interning])</p>
</li>
<li>
<p>发生驻留之后, 许多变量可能指向内存中的相同字符串对象. (从而节省内存)</p>
</li>
<li>
<p>在上面的代码中, 字符串是隐式驻留的. 何时发生隐式驻留则取决于具体的实现. 这里有一些方法可以用来猜测字符串是否会被驻留:</p>
<ul>
<li>所有长度为 0 和长度为 1 的字符串都被驻留.</li>
<li>字符串在编译时被实现 (<code>'wtf'</code> 将被驻留, 但是 <code>''.join(['w', 't', 'f'])</code> 将不会被驻留)</li>
<li>字符串中只包含字母，数字或下划线时将会驻留. 所以 <code>'wtf!'</code> 由于包含 <code>!</code> 而未被驻留. 可以在<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/3.6/Objects/codeobject.c#L19">这里</a>找到 CPython 对此规则的实现.</li>
</ul>
</li>
<li>
<p>当在同一行将 <code>a</code> 和 <code>b</code> 的值设置为 <code>&quot;wtf!&quot;</code> 的时候, Python 解释器会创建一个新对象, 然后同时引用第二个变量(译: 仅适用于 3.7 以下, 详细情况请看<a target="_blank" rel="noopener" href="https://github.com/leisurelicht/wtfpython-cn/issues/13">这里</a>). 如果你在不同的行上进行赋值操作, 它就不会“知道”已经有一个 <code>wtf！</code> 对象 (因为 <code>&quot;wtf!&quot;</code> 不是按照上面提到的方式被隐式驻留的). 它是一种编译器优化, 特别适用于交互式环境.</p>
</li>
<li>
<p>常量折叠(constant folding) 是 Python 中的一种 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Peephole_optimization">窥孔优化(peephole optimization)</a> 技术. 这意味着在编译时表达式 <code>'a'*20</code> 会被替换为 <code>'aaaaaaaaaaaaaaaaaaaa'</code> 以减少运行时的时钟周期. 只有长度小于 20 的字符串才会发生常量折叠. (为啥? 想象一下由于表达式 <code>'a'*10**10</code> 而生成的 <code>.pyc</code> 文件的大小). 相关的源码实现在<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/3.6/Python/peephole.c#L288">这里</a>.</p>
</li>
<li>
<p>如果你是使用 3.7 版本中运行上述示例代码, 会发现部分代码的运行结果与注释说明相同. 这是因为在 3.7 版本中, 常量折叠已经从窥孔优化器迁移至新的 AST 优化器, 后者可以以更高的一致性来执行优化. (由 Eugene Toder 和 INADA Naoki 在 <a target="_blank" rel="noopener" href="https://bugs.python.org/issue29469">bpo-29469</a> 和 <a target="_blank" rel="noopener" href="https://bugs.python.org/issue11549">bpo-11549</a> 中贡献.)</p>
</li>
<li>
<p>(译: 但是在最新的 3.8 版本中, 结果又变回去了. 虽然 3.8 版本和 3.7 版本一样, 都是使用 AST 优化器. 目前不确定官方对 3.8 版本的 AST 做了什么调整.)</p>
</li>
</ul>
<hr>
<h3 id="Time-for-some-hash-brownies-是时候来点蛋糕了">&gt; Time for some hash brownies!/是时候来点蛋糕了!</h3>
<ul>
<li>hash brownie 指一种含有大麻成分的蛋糕, 所以这里是句双关</li>
</ul>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">some_dict = &#123;&#125;</span><br><span class="line">some_dict[<span class="number">5.5</span>] = <span class="string">&quot;Ruby&quot;</span></span><br><span class="line">some_dict[<span class="number">5.0</span>] = <span class="string">&quot;JavaScript&quot;</span></span><br><span class="line">some_dict[<span class="number">5</span>] = <span class="string">&quot;Python&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict[<span class="number">5.5</span>]</span><br><span class="line"><span class="string">&quot;Ruby&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict[<span class="number">5.0</span>]</span><br><span class="line"><span class="string">&quot;Python&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict[<span class="number">5</span>]</span><br><span class="line"><span class="string">&quot;Python&quot;</span></span><br></pre></td></tr></table></figure>
<p>“Python” 消除了 “JavaScript” 的存在?</p>
<h4 id="💡-说明-3">💡 说明:</h4>
<ul>
<li>Python 字典通过检查键值是否相等和比较哈希值来确定两个键是否相同.</li>
<li>具有相同值的不可变对象在 Python 中始终具有相同的哈希值.<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">5</span> == <span class="number">5.0</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hash</span>(<span class="number">5</span>) == <span class="built_in">hash</span>(<span class="number">5.0</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<strong>注意:</strong> 具有不同值的对象也可能具有相同的哈希值（哈希冲突）.</li>
<li>当执行 <code>some_dict[5] = &quot;Python&quot;</code> 语句时, 因为 Python 将 <code>5</code> 和 <code>5.0</code> 识别为 <code>some_dict</code> 的同一个键, 所以已有值 “JavaScript” 就被 “Python” 覆盖了.</li>
<li>这个 StackOverflow 的 <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/32211042/4354153">回答</a> 漂亮地解释了这背后的基本原理.</li>
</ul>
<hr>
<h3 id="Return-return-everywhere-到处返回！">&gt; Return return everywhere!/到处返回！</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">some_func</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;from_try&#x27;</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;from_finally&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func()</span><br><span class="line"><span class="string">&#x27;from_finally&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-4">💡 说明:</h4>
<ul>
<li>当在 “try…finally” 语句的 <code>try</code> 中执行 <code>return</code>, <code>break</code> 或 <code>continue</code> 后, <code>finally</code> 子句依然会执行.</li>
<li>函数的返回值由最后执行的 <code>return</code> 语句决定. 由于 <code>finally</code> 子句一定会执行, 所以 <code>finally</code> 子句中的 <code>return</code> 将始终是最后执行的语句.</li>
</ul>
<hr>
<h3 id="Deep-down-we’re-all-the-same-本质上-我们都一样">&gt; Deep down, we’re all the same./本质上,我们都一样. *</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WTF</span>:</span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>WTF() == WTF() <span class="comment"># 两个不同的对象应该不相等</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>WTF() <span class="keyword">is</span> WTF() <span class="comment"># 也不相同</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hash</span>(WTF()) == <span class="built_in">hash</span>(WTF()) <span class="comment"># 哈希值也应该不同</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(WTF()) == <span class="built_in">id</span>(WTF())</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-5">💡 说明:</h4>
<ul>
<li>
<p>当调用 <code>id</code> 函数时, Python 创建了一个 <code>WTF</code> 类的对象并传给 <code>id</code> 函数. 然后 <code>id</code> 函数获取其 id 值 (也就是内存地址), 然后丢弃该对象. 该对象就被销毁了.</p>
</li>
<li>
<p>当我们连续两次进行这个操作时, Python 会将相同的内存地址分配给第二个对象. 因为 (在 CPython 中) <code>id</code> 函数使用对象的内存地址作为对象的 id 值, 所以两个对象的 id 值是相同的.</p>
</li>
<li>
<p>综上, 对象的 id 值仅仅在对象的生命周期内唯一. 在对象被销毁之后, 或被创建之前, 其他对象可以具有相同的 id 值.</p>
</li>
<li>
<p>那为什么 <code>is</code> 操作的结果为 <code>False</code> 呢? 让我们看看这段代码.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WTF</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>): <span class="built_in">print</span>(<span class="string">&quot;I&quot;</span>)</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>): <span class="built_in">print</span>(<span class="string">&quot;D&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>WTF() <span class="keyword">is</span> WTF()</span><br><span class="line">I</span><br><span class="line">I</span><br><span class="line">D</span><br><span class="line">D</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(WTF()) == <span class="built_in">id</span>(WTF())</span><br><span class="line">I</span><br><span class="line">D</span><br><span class="line">I</span><br><span class="line">D</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>正如你所看到的, 对象销毁的顺序是造成所有不同之处的原因.</p>
</li>
</ul>
<hr>
<h3 id="For-what-为什么">&gt; For what?/为什么?</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">some_string = <span class="string">&quot;wtf&quot;</span></span><br><span class="line">some_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i, some_dict[i] <span class="keyword">in</span> <span class="built_in">enumerate</span>(some_string):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict <span class="comment"># 创建了索引字典.</span></span><br><span class="line">&#123;<span class="number">0</span>: <span class="string">&#x27;w&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;t&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;f&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-6">💡 说明:</h4>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/reference/grammar.html">Python 语法</a> 中对 <code>for</code> 的定义是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for_stmt: &#x27;for&#x27; exprlist &#x27;in&#x27; testlist &#x27;:&#x27; suite [&#x27;else&#x27; &#x27;:&#x27; suite]</span><br></pre></td></tr></table></figure>
<p>其中 <code>exprlist</code> 指分配目标. 这意味着对可迭代对象中的<strong>每一项都会执行</strong>类似 <code>&#123;exprlist&#125; = &#123;next_value&#125;</code> 的操作.</p>
<p>一个有趣的例子说明了这一点:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    i = <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>你可曾觉得这个循环只会运行一次?</p>
<p><strong>💡 说明:</strong></p>
<ul>
<li>由于循环在 Python 中工作方式, 赋值语句 <code>i = 10</code> 并不会影响迭代循环, 在每次迭代开始之前, 迭代器(这里指 <code>range(4)</code>) 生成的下一个元素就被解包并赋值给目标列表的变量(这里指 <code>i</code>)了.</li>
</ul>
</li>
<li>
<p>在每一次的迭代中, <code>enumerate(some_string)</code> 函数就生成一个新值 <code>i</code> (计数器增加) 并从 <code>some_string</code> 中获取一个字符. 然后将字典 <code>some_dict</code> 键 <code>i</code> (刚刚分配的) 的值设为该字符. 本例中循环的展开可以简化为:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>i, some_dict[i] = (<span class="number">0</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i, some_dict[i] = (<span class="number">1</span>, <span class="string">&#x27;t&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i, some_dict[i] = (<span class="number">2</span>, <span class="string">&#x27;f&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Evaluation-time-discrepancy-执行时机差异">&gt; Evaluation time discrepancy/执行时机差异</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array = [<span class="number">1</span>, <span class="number">8</span>, <span class="number">15</span>]</span><br><span class="line">g = (x <span class="keyword">for</span> x <span class="keyword">in</span> array <span class="keyword">if</span> array.count(x) &gt; <span class="number">0</span>)</span><br><span class="line">array = [<span class="number">2</span>, <span class="number">8</span>, <span class="number">22</span>]</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">list</span>(g))</span><br><span class="line">[<span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">array_1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">g1 = (x <span class="keyword">for</span> x <span class="keyword">in</span> array_1)</span><br><span class="line">array_1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">array_2 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">g2 = (x <span class="keyword">for</span> x <span class="keyword">in</span> array_2)</span><br><span class="line">array_2[:] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">list</span>(g1))</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">list</span>(g2))</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-7">💡 说明</h4>
<ul>
<li>在<a target="_blank" rel="noopener" href="https://wiki.python.org/moin/Generators">生成器</a>表达式中, <code>in</code> 子句在声明时执行, 而条件子句则是在运行时执行.</li>
<li>所以在运行前, <code>array</code> 已经被重新赋值为 <code>[2, 8, 22]</code>, 因此对于之前的 <code>1</code>, <code>8</code> 和 <code>15</code>, 只有 <code>count(8)</code> 的结果是大于 <code>0</code> 的, 所以生成器只会生成 <code>8</code>.</li>
<li>第二部分中 <code>g1</code> 和 <code>g2</code> 的输出差异则是由于变量 <code>array_1</code> 和 <code>array_2</code> 被重新赋值的方式导致的.</li>
<li>在第一种情况下, <code>array_1</code> 被绑定到新对象 <code>[1,2,3,4,5]</code>, 因为 <code>in</code> 子句是在声明时被执行的， 所以它仍然引用旧对象 <code>[1,2,3,4]</code>(并没有被销毁).</li>
<li>在第二种情况下, 对 <code>array_2</code> 的切片赋值将相同的旧对象 <code>[1,2,3,4]</code> 原地更新为 <code>[1,2,3,4,5]</code>. 因此 <code>g2</code> 和 <code>array_2</code> 仍然引用同一个对象(这个对象现在已经更新为 <code>[1,2,3,4,5]</code>).</li>
</ul>
<hr>
<h3 id="is-is-not-what-it-is-出人意料的is">&gt; <code>is</code> is not what it is!/出人意料的<code>is</code>!</h3>
<p>下面是一个在互联网上非常有名的例子.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">256</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">256</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">257</span>; b = <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-8">💡 说明:</h4>
<p><strong><code>is</code> 和 <code>==</code> 的区别</strong></p>
<ul>
<li><code>is</code> 运算符检查两个运算对象是否引用自同一对象 (即, 它检查两个运算对象是否相同).</li>
<li><code>==</code> 运算符比较两个运算对象的值是否相等.</li>
<li>因此 <code>is</code> 代表引用相同, <code>==</code> 代表值相等. 下面的例子可以很好的说明这点,<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[] == []</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[] <span class="keyword">is</span> [] <span class="comment"># 这两个空列表位于不同的内存地址.</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><code>256</code> 是一个已经存在的对象, 而 <code>257</code> 不是</strong></p>
<p>当你启动 Python 的时候, 数值为 <code>-5</code> 到 <code>256</code> 的对象就已经被分配好了. 这些数字因为经常被使用, 所以会被提前准备好.</p>
<p>Python 通过这种创建小整数池的方式来避免小整数频繁的申请和销毁内存空间.</p>
<p>引用自 <a target="_blank" rel="noopener" href="https://docs.python.org/3/c-api/long.html">https://docs.python.org/3/c-api/long.html</a></p>
<blockquote>
<p>当前的实现为-5 到 256 之间的所有整数保留一个整数对象数组, 当你创建了一个该范围内的整数时, 你只需要返回现有对象的引用. 所以改变 1 的值是有可能的. 我怀疑这种行为在 Python 中是未定义行为. :-)</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(<span class="number">256</span>)</span><br><span class="line"><span class="number">10922528</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">256</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">256</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(a)</span><br><span class="line"><span class="number">10922528</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(b)</span><br><span class="line"><span class="number">10922528</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(<span class="number">257</span>)</span><br><span class="line"><span class="number">140084850247312</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(x)</span><br><span class="line"><span class="number">140084850247440</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(y)</span><br><span class="line"><span class="number">140084850247344</span></span><br></pre></td></tr></table></figure>
<p>这里解释器并没有智能到能在执行 <code>y = 257</code> 时意识到我们已经创建了一个整数 <code>257</code>, 所以它在内存中又新建了另一个对象.</p>
<p><strong>当 <code>a</code> 和 <code>b</code> 在同一行中使用相同的值初始化时，会指向同一个对象.</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b = <span class="number">257</span>, <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(a)</span><br><span class="line"><span class="number">140640774013296</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(b)</span><br><span class="line"><span class="number">140640774013296</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">257</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(a)</span><br><span class="line"><span class="number">140640774013392</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(b)</span><br><span class="line"><span class="number">140640774013488</span></span><br></pre></td></tr></table></figure>
<ul>
<li>当 a 和 b 在同一行中被设置为 <code>257</code> 时, Python 解释器会创建一个新对象, 然后同时引用第二个变量. 如果你在不同的行上进行, 它就不会 “知道” 已经存在一个 <code>257</code> 对象了.</li>
<li>这是一种特别为交互式环境做的编译器优化. 当你在实时解释器中输入两行的时候, 他们会单独编译, 因此也会单独进行优化. 如果你在 <code>.py</code> 文件中尝试这个例子, 则不会看到相同的行为, 因为文件是一次性编译的.</li>
</ul>
<hr>
<h3 id="A-tic-tac-toe-where-X-wins-in-the-first-attempt-一蹴即至">&gt; A tic-tac-toe where X wins in the first attempt!/一蹴即至!</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们先初始化一个变量row</span></span><br><span class="line">row = [<span class="string">&quot;&quot;</span>]*<span class="number">3</span> <span class="comment">#row i[&#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span></span><br><span class="line"><span class="comment"># 并创建一个变量board</span></span><br><span class="line">board = [row]*<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>board</span><br><span class="line">[[<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>], [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>], [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>board[<span class="number">0</span>]</span><br><span class="line">[<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>board[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>board</span><br><span class="line">[[<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>], [<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>], [<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]]</span><br></pre></td></tr></table></figure>
<p>我们有没有赋值过 3 个 “X” 呢？</p>
<h4 id="💡-说明-9">💡 说明:</h4>
<p>当我们初始化 <code>row</code> 变量时, 下面这张图展示了内存中的情况。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/tic-tac-toe/after_row_initialized.png" alt="image"></p>
<p>而当通过对 <code>row</code> 做乘法来初始化 <code>board</code> 时, 内存中的情况则如下图所示 (每个元素 <code>board[0]</code>, <code>board[1]</code> 和 <code>board[2]</code> 都和 <code>row</code> 一样引用了同一列表.)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/tic-tac-toe/after_board_initialized.png" alt="image"></p>
<p>我们可以通过不使用变量 <code>row</code> 生成 <code>board</code> 来避免这种情况. (<a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython/issues/68">这个</a>issue 提出了这个需求.)</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>board = [[<span class="string">&#x27;&#x27;</span>]*<span class="number">3</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>board</span><br><span class="line">[[<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>], [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>], [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]]</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="The-sticky-output-function-麻烦的输出">&gt; The sticky output function/麻烦的输出</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">funcs = []</span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_func</span>():</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    funcs.append(some_func)</span><br><span class="line">    results.append(some_func()) <span class="comment"># 注意这里函数被执行了</span></span><br><span class="line"></span><br><span class="line">funcs_results = [func() <span class="keyword">for</span> func <span class="keyword">in</span> funcs]</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>results</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>funcs_results</span><br><span class="line">[<span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure>
<p>即使每次在迭代中将 <code>some_func</code> 加入 <code>funcs</code> 前的 <code>x</code> 值都不相同, 所有的函数还是都返回 6.</p>
<p>// 再换个例子</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>powers_of_x = [<span class="keyword">lambda</span> x: x**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[f(<span class="number">2</span>) <span class="keyword">for</span> f <span class="keyword">in</span> powers_of_x]</span><br><span class="line">[<span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="number">512</span>]</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-10">💡 说明:</h4>
<ul>
<li>
<p>当在循环内部定义一个函数时, 如果该函数在其主体中使用了循环变量, 则闭包函数将与循环变量绑定, 而不是它的值. 因此, 所有的函数都是使用最后分配给变量的值来进行计算的.</p>
</li>
<li>
<p>可以通过将循环变量作为命名变量传递给函数来获得预期的结果. <strong>为什么这样可行?</strong> 因为这会在函数内再次定义一个局部变量.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">funcs = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_func</span>(<span class="params">x=x</span>):</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    funcs.append(some_func)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>funcs_results = [func() <span class="keyword">for</span> func <span class="keyword">in</span> funcs]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>funcs_results</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="is-not-is-not-is-not-is-not-不是-is-not">&gt; <code>is not ...</code> is not <code>is (not ...)</code>/<code>is not ...</code> 不是 <code>is (not ...)</code></h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;something&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;something&#x27;</span> <span class="keyword">is</span> (<span class="keyword">not</span> <span class="literal">None</span>)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-11">💡 说明:</h4>
<ul>
<li><code>is not</code> 是个单独的二元运算符, 与分别使用 <code>is</code> 和 <code>not</code> 不同.</li>
<li>如果操作符两侧的变量指向同一个对象, 则 <code>is not</code> 的结果为 <code>False</code>, 否则结果为 <code>True</code>.</li>
</ul>
<hr>
<h3 id="The-surprising-comma-意外的逗号">&gt; The surprising comma/意外的逗号</h3>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y,</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x, y)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">x=<span class="number">4</span>, y=<span class="number">5</span>,</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(x, y)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">x, **kwargs,</span>):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">x, **kwargs,</span>):</span><br><span class="line">                     ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">*args,</span>):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">h</span>(<span class="params">*args,</span>):</span><br><span class="line">                ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-12">💡 说明:</h4>
<ul>
<li>在 Python 函数的形式参数列表中, 尾随逗号并不一定是合法的.</li>
<li>在 Python 中, 参数列表部分用前置逗号定义, 部分用尾随逗号定义. 这种冲突导致逗号被夹在中间, 没有规则定义它.(译:这一句看得我也很懵逼,只能强翻了.详细解释看下面的讨论帖会一目了然.)</li>
<li><strong>注意:</strong> 尾随逗号的问题已经在 Python 3.6 中被<a target="_blank" rel="noopener" href="https://bugs.python.org/issue9232">修复</a>了. 而这篇<a target="_blank" rel="noopener" href="https://bugs.python.org/issue9232#msg248399">帖子</a>中则简要讨论了 Python 中尾随逗号的不同用法.</li>
</ul>
<hr>
<h3 id="Backslashes-at-the-end-of-string-字符串末尾的反斜杠">&gt; Backslashes at the end of string/字符串末尾的反斜杠</h3>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&quot;\\ C:\\&quot;)</span><br><span class="line">\ C:\</span><br><span class="line">&gt;&gt;&gt; print(r&quot;\ C:&quot;)</span><br><span class="line">\ C:</span><br><span class="line">&gt;&gt;&gt; print(r&quot;\ C:\&quot;)</span><br><span class="line"></span><br><span class="line">    File &quot;&lt;stdin&gt;&quot;, line 1</span><br><span class="line">      print(r&quot;\ C:\&quot;)</span><br><span class="line">                     ^</span><br><span class="line">SyntaxError: EOL while scanning string literal</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-13">💡 说明:</h4>
<ul>
<li>在以 <code>r</code> 开头的原始字符串中, 反斜杠并没有特殊含义.<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">repr</span>(<span class="string">r&quot;wt\&quot;f&quot;</span>))</span><br><span class="line"><span class="string">&#x27;wt\\&quot;f&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li>解释器所做的只是简单的改变了反斜杠的行为, 因此会直接放行反斜杠及后一个的字符. 这就是反斜杠在原始字符串末尾不起作用的原因.</li>
</ul>
<hr>
<h3 id="not-knot-别纠结">&gt; not knot!/别纠结!</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="literal">True</span></span><br><span class="line">y = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">not</span> x == y</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x == <span class="keyword">not</span> y</span><br><span class="line">  File <span class="string">&quot;&lt;input&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    x == <span class="keyword">not</span> y</span><br><span class="line">           ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-14">💡 说明:</h4>
<ul>
<li>运算符的优先级会影响表达式的求值顺序, 而在 Python 中 <code>==</code> 运算符的优先级要高于 <code>not</code> 运算符.</li>
<li>所以 <code>not x == y</code> 相当于 <code>not (x == y)</code>, 同时等价于 <code>not (True == False)</code>, 最后的运算结果就是 <code>True</code>.</li>
<li>之所以 <code>x == not y</code> 会抛一个 <code>SyntaxError</code> 异常, 是因为它会被认为等价于 <code>(x == not) y</code>, 而不是你一开始期望的 <code>x == (not y)</code>.</li>
<li>解释器期望 <code>not</code> 标记是 <code>not in</code> 操作符的一部分 (因为 <code>==</code> 和 <code>not in</code> 操作符具有相同的优先级), 但是它在 <code>not</code> 标记后面找不到 <code>in</code> 标记, 所以会抛出 <code>SyntaxError</code> 异常.</li>
</ul>
<hr>
<h3 id="Half-triple-quoted-strings-三个引号">&gt; Half triple-quoted strings/三个引号</h3>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&#x27;wtfpython&#x27;</span><span class="string">&#x27;&#x27;</span>)</span><br><span class="line">wtfpython</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;wtfpython&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line">wtfpython</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 下面的语句会抛出 `SyntaxError` 异常</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># print(&#x27;&#x27;&#x27;wtfpython&#x27;)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># print(&quot;&quot;&quot;wtfpython&quot;)</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-15">💡 说明:</h4>
<ul>
<li>Python 提供隐式的<a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/lexical_analysis.html#string-literal-concatenation">字符串连接</a>, 例如,<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&quot;wtf&quot; &quot;python&quot;)</span><br><span class="line">wtfpython</span><br><span class="line">&gt;&gt;&gt; print(&quot;wtf&quot; &quot;&quot;) # or &quot;wtf&quot;&quot;&quot;</span><br><span class="line">wtf</span><br></pre></td></tr></table></figure>
</li>
<li><code>'''</code> 和 <code>&quot;&quot;&quot;</code> 在 Python 中也是字符串定界符, Python 解释器在先遇到三个引号的的时候会尝试再寻找三个终止引号作为定界符, 如果不存在则会导致 <code>SyntaxError</code> 异常.</li>
</ul>
<hr>
<h3 id="Midnight-time-doesn’t-exist-不存在的午夜">&gt; Midnight time doesn’t exist?/不存在的午夜?</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">midnight = datetime(<span class="number">2018</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">midnight_time = midnight.time()</span><br><span class="line"></span><br><span class="line">noon = datetime(<span class="number">2018</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>)</span><br><span class="line">noon_time = noon.time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> midnight_time:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Time at midnight is&quot;</span>, midnight_time)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> noon_time:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Time at noon is&quot;</span>, noon_time)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&#x27;Time at noon is&#x27;</span>, datetime.time(12, 0))</span><br></pre></td></tr></table></figure>
<p>midnight_time 并没有被输出.</p>
<h4 id="💡-说明-16">💡 说明:</h4>
<p>在 Python 3.5 之前, 如果 <code>datetime.time</code> 对象存储的 UTC 的午夜时间(译: 就是 <code>00:00</code>), 那么它的布尔值会被认为是 <code>False</code>. 当使用 <code>if obj:</code> 语句来检查 <code>obj</code> 是否为 <code>null</code> 或者某些“空”值的时候, 很容易出错.</p>
<hr>
<h3 id="What’s-wrong-with-booleans-布尔你咋了">&gt; What’s wrong with booleans?/布尔你咋了?</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个简单的例子, 统计下面可迭代对象中的布尔型值的个数和整型值的个数</span></span><br><span class="line">mixed_list = [<span class="literal">False</span>, <span class="number">1.0</span>, <span class="string">&quot;some_string&quot;</span>, <span class="number">3</span>, <span class="literal">True</span>, [], <span class="literal">False</span>]</span><br><span class="line">integers_found_so_far = <span class="number">0</span></span><br><span class="line">booleans_found_so_far = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> mixed_list:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, <span class="built_in">int</span>):</span><br><span class="line">        integers_found_so_far += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(item, <span class="built_in">bool</span>):</span><br><span class="line">        booleans_found_so_far += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>integers_found_so_far</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>booleans_found_so_far</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">another_dict = &#123;&#125;</span><br><span class="line">another_dict[<span class="literal">True</span>] = <span class="string">&quot;JavaScript&quot;</span></span><br><span class="line">another_dict[<span class="number">1</span>] = <span class="string">&quot;Ruby&quot;</span></span><br><span class="line">another_dict[<span class="number">1.0</span>] = <span class="string">&quot;Python&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_dict[<span class="literal">True</span>]</span><br><span class="line"><span class="string">&quot;Python&quot;</span></span><br></pre></td></tr></table></figure>
<p>3.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_bool = <span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;wtf&quot;</span>*some_bool</span><br><span class="line"><span class="string">&#x27;wtf&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_bool = <span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;wtf&quot;</span>*some_bool</span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-17">💡 说明:</h4>
<ul>
<li>
<p>布尔值是 <code>int</code> 的子类</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="literal">True</span>, <span class="built_in">int</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="literal">False</span>, <span class="built_in">int</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>所以 <code>True</code> 的整数值是 <code>1</code>, 而 <code>False</code> 的整数值是 <code>0</code>.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">True</span> == <span class="number">1</span> == <span class="number">1.0</span> <span class="keyword">and</span> <span class="literal">False</span> == <span class="number">0</span> == <span class="number">0.0</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>关于其背后的原理, 请看这个 StackOverflow 的<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/8169049/4354153">回答</a>.</p>
</li>
</ul>
<hr>
<h3 id="Class-attributes-and-instance-attributes-类属性和实例属性">&gt; Class attributes and instance attributes/类属性和实例属性</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>A.x, B.x, C.x</span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>B.x = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>A.x, B.x, C.x</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>A.x = <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>A.x, B.x, C.x</span><br><span class="line">(<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = A()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.x, A.x</span><br><span class="line">(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.x += <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.x, A.x</span><br><span class="line">(<span class="number">4</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>:</span><br><span class="line">    some_var = <span class="number">15</span></span><br><span class="line">    some_list = [<span class="number">5</span>]</span><br><span class="line">    another_list = [<span class="number">5</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x</span>):</span><br><span class="line">        self.some_var = x + <span class="number">1</span></span><br><span class="line">        self.some_list = self.some_list + [x]</span><br><span class="line">        self.another_list += [x]</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_obj = SomeClass(<span class="number">420</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_obj.some_list</span><br><span class="line">[<span class="number">5</span>, <span class="number">420</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_obj.another_list</span><br><span class="line">[<span class="number">5</span>, <span class="number">420</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_obj = SomeClass(<span class="number">111</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_obj.some_list</span><br><span class="line">[<span class="number">5</span>, <span class="number">111</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_obj.another_list</span><br><span class="line">[<span class="number">5</span>, <span class="number">420</span>, <span class="number">111</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_obj.another_list <span class="keyword">is</span> SomeClass.another_list</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_obj.another_list <span class="keyword">is</span> some_obj.another_list</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-18">💡 说明:</h4>
<ul>
<li>类变量和实例变量在内部是通过类对象的字典来处理(译: 就是 <code>__dict__</code> 属性). 如果在当前类的字典中找不到的话就去它的父类中寻找.</li>
<li><code>+=</code> 运算符会在原地修改可变对象, 而不是创建新对象. 因此, 在这种情况下, 修改一个实例的属性会影响其他实例和类属性.</li>
</ul>
<hr>
<h3 id="yielding-None-生成-None">&gt; yielding None/生成 None</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">some_iterable = (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">some_func</span>(<span class="params">val</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;something&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> some_iterable]</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[(<span class="keyword">yield</span> x) <span class="keyword">for</span> x <span class="keyword">in</span> some_iterable]</span><br><span class="line">&lt;generator <span class="built_in">object</span> &lt;listcomp&gt; at <span class="number">0x7f70b0a4ad58</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>([(<span class="keyword">yield</span> x) <span class="keyword">for</span> x <span class="keyword">in</span> some_iterable])</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>((<span class="keyword">yield</span> x) <span class="keyword">for</span> x <span class="keyword">in</span> some_iterable)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;b&#x27;</span>, <span class="literal">None</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(some_func((<span class="keyword">yield</span> x)) <span class="keyword">for</span> x <span class="keyword">in</span> some_iterable)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;something&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;something&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-19">💡 说明:</h4>
<ul>
<li>来源和解释可以在这里找到: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32139885/yield-in-list-comprehensions-and-generator-expressions">https://stackoverflow.com/questions/32139885/yield-in-list-comprehensions-and-generator-expressions</a></li>
<li>相关错误报告: <a target="_blank" rel="noopener" href="http://bugs.python.org/issue10544">http://bugs.python.org/issue10544</a></li>
<li>这个 bug 在 3.7 以后的版本中不被推荐使用, 并在 3.8 中被修复. 因此在 3.8 中尝试在推导式中使用 yield, 只会得到一个 SyntaxError. 详细内容可以看<a target="_blank" rel="noopener" href="https://docs.python.org/dev/whatsnew/3.7.html#deprecated-python-behavior">3.7 更新内容</a>, <a target="_blank" rel="noopener" href="https://docs.python.org/dev/whatsnew/3.8.html#changes-in-python-behavior">3.8 更新内容</a>.</li>
</ul>
<hr>
<h3 id="Mutating-the-immutable-强人所难">&gt; Mutating the immutable!/强人所难</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">some_tuple = (<span class="string">&quot;A&quot;</span>, <span class="string">&quot;tuple&quot;</span>, <span class="string">&quot;with&quot;</span>, <span class="string">&quot;values&quot;</span>)</span><br><span class="line">another_tuple = ([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>])</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_tuple[<span class="number">2</span>] = <span class="string">&quot;change this&quot;</span></span><br><span class="line">TypeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> does <span class="keyword">not</span> support item assignment</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_tuple[<span class="number">2</span>].append(<span class="number">1000</span>) <span class="comment"># 这里不出现错误</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_tuple</span><br><span class="line">([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">1000</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_tuple[<span class="number">2</span>] += [<span class="number">99</span>, <span class="number">999</span>]</span><br><span class="line">TypeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> does <span class="keyword">not</span> support item assignment</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_tuple</span><br><span class="line">([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">1000</span>, <span class="number">99</span>, <span class="number">999</span>])</span><br></pre></td></tr></table></figure>
<p>我还以为元组是不可变的呢…</p>
<h4 id="💡-说明-20">💡 说明:</h4>
<ul>
<li>
<p>引用 <a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/datamodel.html">https://docs.python.org/2/reference/datamodel.html</a></p>
<blockquote>
<p>不可变序列</p>
</blockquote>
<pre><code>  不可变序列的对象一旦创建就不能再改变. (如果对象包含对其他对象的引用，则这些其他对象可能是可变的并且可能会被修改; 但是，由不可变对象直接引用的对象集合不能更改.)
</code></pre>
</li>
<li>
<p><code>+=</code> 操作符在原地修改了列表. 元素赋值操作并不工作, 但是当异常抛出时, 元素已经在原地被修改了.</p>
</li>
</ul>
<p>(译: 对于不可变对象, 这里指 tuple, <code>+=</code> 并不是原子操作, 而是 <code>extend</code> 和 <code>=</code> 两个动作, 这里 <code>=</code> 操作虽然会抛出异常, 但 <code>extend</code> 操作已经修改成功了. 详细解释可以看<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000010767068">这里</a>)</p>
<hr>
<h3 id="The-disappearing-variable-from-outer-scope-消失的外部变量">&gt; The disappearing variable from outer scope/消失的外部变量</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">7</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(e)</span><br><span class="line"><span class="comment"># prints nothing</span></span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 3.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(e)</span><br><span class="line">NameError: name <span class="string">&#x27;e&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-21">💡 说明:</h4>
<ul>
<li>
<p>出处: <a target="_blank" rel="noopener" href="https://docs.python.org/3/reference/compound_stmts.html#except">https://docs.python.org/3/reference/compound_stmts.html#except</a></p>
<p>当使用 <code>as</code> 为目标分配异常的时候, 将在 except 子句的末尾清除该异常.</p>
<p>这就好像</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> E <span class="keyword">as</span> N:</span><br><span class="line">    foo</span><br></pre></td></tr></table></figure>
<p>会被翻译成</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> E <span class="keyword">as</span> N:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        foo</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">del</span> N</span><br></pre></td></tr></table></figure>
<p>这意味着异常必须在被赋值给其他变量才能在 <code>except</code> 子句之后引用它. 而异常之所以会被清除, 则是由于上面附加的回溯信息(trackback)会和栈帧(stack frame)形成循环引用, 使得该栈帧中的所有本地变量在下一次垃圾回收发生之前都处于活动状态.(译: 也就是说不会被回收)</p>
</li>
<li>
<p>子句在 Python 中并没有独立的作用域. 示例中的所有内容都处于同一作用域内, 所以变量 <code>e</code> 会由于执行了 <code>except</code> 子句而被删除. 而对于有独立的内部作用域的函数来说情况就不一样了. 下面的例子说明了这一点:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">del</span>(x)</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">x = <span class="number">5</span></span><br><span class="line">y = [<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;f(x)</span><br><span class="line">UnboundLocalError: local variable <span class="string">&#x27;x&#x27;</span> referenced before assignment</span><br><span class="line">&gt;&gt;&gt;f(y)</span><br><span class="line">UnboundLocalError: local variable <span class="string">&#x27;x&#x27;</span> referenced before assignment</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y</span><br><span class="line">[<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 Python 2.x 中, <code>Exception()</code> 实例被赋值给了变量 <code>e</code>, 所以当你尝试打印结果的时候, 它的输出为空.（译: 正常的 Exception 实例打印出来就是空）</p>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e</span><br><span class="line">Exception()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span> e</span><br><span class="line"><span class="comment"># 没有打印任何内容!</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="When-True-is-actually-False-真亦假">&gt; When True is actually False/真亦假</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">True</span> = <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> <span class="literal">True</span> == <span class="literal">False</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I&#x27;ve lost faith in truth!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I&#x27;ve lost faith in truth!</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-22">💡 说明:</h4>
<ul>
<li>最初, Python 并没有 <code>bool</code> 型 (人们用 0 表示假值, 用非零值比如 1 作为真值). 后来他们添加了 <code>True</code>, <code>False</code>, 和 <code>bool</code> 型, 但是, 为了向后兼容, 他们没法把 <code>True</code> 和 <code>False</code> 设置为常量, 只是设置成了内置变量.</li>
<li>Python 3 由于不再需要向后兼容, 终于可以修复这个问题了, 所以这个例子无法在 Python 3.x 中执行!</li>
</ul>
<hr>
<h3 id="From-filled-to-None-in-one-instruction…-从有到无…">&gt; From filled to None in one instruction…/从有到无…</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">some_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">some_dict = &#123;</span><br><span class="line">  <span class="string">&quot;key_1&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;key_2&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="string">&quot;key_3&quot;</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">some_list = some_list.append(<span class="number">4</span>)</span><br><span class="line">some_dict = some_dict.update(&#123;<span class="string">&quot;key_4&quot;</span>: <span class="number">4</span>&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(some_list)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(some_dict)</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-23">💡 说明:</h4>
<p>大多数修改序列/映射对象的方法, 比如 <code>list.append</code>, <code>dict.update</code>, <code>list.sort</code> 等等. 都是原地修改对象并返回 <code>None</code>. 这样做的理由是, 如果操作可以原地完成, 就可以避免创建对象的副本来提高性能. (参考<a target="_blank" rel="noopener" href="http://docs.python.org/2/faq/design.html#why-doesn-t-list-sort-return-the-sorted-list">这里</a>)</p>
<hr>
<h3 id="Subclass-relationships-子类关系">&gt; Subclass relationships/子类关系 *</h3>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Hashable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">issubclass</span>(<span class="built_in">list</span>, <span class="built_in">object</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">issubclass</span>(<span class="built_in">object</span>, Hashable)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">issubclass</span>(<span class="built_in">list</span>, Hashable)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>子类关系应该是可传递的, 对吧? (即, 如果 <code>A</code> 是 <code>B</code> 的子类, <code>B</code> 是 <code>C</code> 的子类, 那么 <code>A</code> <em>应该</em> 是 <code>C</code> 的子类.)</p>
<h4 id="💡-说明-24">💡 说明:</h4>
<ul>
<li>Python 中的子类关系并不一定是传递的. 任何人都可以在元类中随意定义 <code>__subclasscheck__</code>.</li>
<li>当 <code>issubclass(cls, Hashable)</code> 被调用时, 它只是在 <code>cls</code> 中寻找 <code>__hash__</code> 方法或者从继承的父类中寻找 <code>__hash__</code> 方法.</li>
<li>由于 <code>object</code> is 可散列的(hashable), 但是 <code>list</code> 是不可散列的, 所以它打破了这种传递关系.</li>
<li>在<a target="_blank" rel="noopener" href="https://www.naftaliharris.com/blog/python-subclass-intransitivity/">这里</a>可以找到更详细的解释.</li>
</ul>
<hr>
<h3 id="The-mysterious-key-type-conversion-神秘的键型转换">&gt; The mysterious key type conversion/神秘的键型转换 *</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>(<span class="title class_ inherited__">str</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">some_dict = &#123;<span class="string">&#x27;s&#x27;</span>:<span class="number">42</span>&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="built_in">list</span>(some_dict.keys())[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">str</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = SomeClass(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict[s] = <span class="number">40</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict <span class="comment"># 预期: 两个不同的键值对</span></span><br><span class="line">&#123;<span class="string">&#x27;s&#x27;</span>: <span class="number">40</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="built_in">list</span>(some_dict.keys())[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">str</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-25">💡 说明:</h4>
<ul>
<li>
<p>由于 <code>SomeClass</code> 会从 <code>str</code> 自动继承 <code>__hash__</code> 方法, 所以 <code>s</code> 对象和 <code>&quot;s&quot;</code> 字符串的哈希值是相同的.</p>
</li>
<li>
<p>而 <code>SomeClass(&quot;s&quot;) == &quot;s&quot;</code> 为 <code>True</code> 是因为 <code>SomeClass</code> 也继承了 <code>str</code> 类 <code>__eq__</code> 方法.</p>
</li>
<li>
<p>由于两者的哈希值相同且相等, 所以它们在字典中表示相同的键.</p>
</li>
<li>
<p>如果想要实现期望的功能, 我们可以重定义 <code>SomeClass</code> 的 <code>__eq__</code> 方法.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>(<span class="title class_ inherited__">str</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">          <span class="built_in">type</span>(self) <span class="keyword">is</span> SomeClass</span><br><span class="line">          <span class="keyword">and</span> <span class="built_in">type</span>(other) <span class="keyword">is</span> SomeClass</span><br><span class="line">          <span class="keyword">and</span> <span class="built_in">super</span>().__eq__(other)</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 当我们自定义 __eq__ 方法时, Python 不会再自动继承 __hash__ 方法</span></span><br><span class="line">  <span class="comment"># 所以我们也需要定义它</span></span><br><span class="line">  __hash__ = <span class="built_in">str</span>.__hash__</span><br><span class="line"></span><br><span class="line">some_dict = &#123;<span class="string">&#x27;s&#x27;</span>:<span class="number">42</span>&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = SomeClass(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict[s] = <span class="number">40</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_dict</span><br><span class="line">&#123;<span class="string">&#x27;s&#x27;</span>: <span class="number">40</span>, <span class="string">&#x27;s&#x27;</span>: <span class="number">42</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>keys = <span class="built_in">list</span>(some_dict.keys())</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(keys[<span class="number">0</span>]), <span class="built_in">type</span>(keys[<span class="number">1</span>])</span><br><span class="line">(__main__.SomeClass, <span class="built_in">str</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Let’s-see-if-you-can-guess-this-看看你能否猜到这一点">&gt; Let’s see if you can guess this?/看看你能否猜到这一点?</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a, b = a[b] = &#123;&#125;, <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">&#123;<span class="number">5</span>: (&#123;...&#125;, <span class="number">5</span>)&#125;</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-26">💡 说明:</h4>
<ul>
<li>
<p>根据 <a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/simple_stmts.html#assignment-statements">Python 语言参考</a>, 赋值语句的形式如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(target_list &quot;=&quot;)+ (expression_list | yield_expression)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>赋值语句计算表达式列表(expression list)(牢记 这可以是单个表达式或以逗号分隔的列表, 后者返回元组)并将单个结果对象从左到右分配给目标列表中的每一项.</p>
</blockquote>
</li>
<li>
<p><code>(target_list &quot;=&quot;)+</code> 中的 <code>+</code> 意味着可以有<strong>一个或多个</strong>目标列表. 在这个例子中, 目标列表是 <code>a, b</code> 和 <code>a[b]</code> (注意表达式列表只能有一个, 在我们的例子中是 <code>&#123;&#125;, 5</code>).</p>
</li>
<li>
<p>表达式列表计算结束后, 将其值自动解包后<strong>从左到右</strong>分配给目标列表(target list). 因此, 在我们的例子中, 首先将 <code>&#123;&#125;, 5</code> 元组并赋值给 <code>a, b</code>, 然后我们就可以得到 <code>a = &#123;&#125;</code> 且 <code>b = 5</code>.</p>
</li>
<li>
<p><code>a</code> 被赋值的 <code>&#123;&#125;</code> 是可变对象.</p>
</li>
<li>
<p>第二个目标列表是 <code>a[b]</code> (你可能觉得这里会报错, 因为在之前的语句中 <code>a</code> 和 <code>b</code> 都还没有被定义. 但是别忘了, 我们刚刚将 <code>a</code> 赋值 <code>&#123;&#125;</code> 且将 <code>b</code> 赋值为 <code>5</code>).</p>
</li>
<li>
<p>现在, 我们将通过将字典中键 <code>5</code> 的值设置为元组 <code>(&#123;&#125;, 5)</code> 来创建循环引用 (输出中的 <code>&#123;...&#125;</code> 指与 <code>a</code> 引用了相同的对象). 下面是一个更简单的循环引用的例子</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list = some_list[<span class="number">0</span>] = [<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list</span><br><span class="line">[[...]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list[<span class="number">0</span>]</span><br><span class="line">[[...]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list <span class="keyword">is</span> some_list[<span class="number">0</span>]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] == some_list</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>我们的例子就是这种情况 (<code>a[b][0]</code> 与 <code>a</code> 是相同的对象)</p>
</li>
<li>
<p>总结一下, 你也可以把例子拆成</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a, b = &#123;&#125;, <span class="number">5</span></span><br><span class="line">a[b] = a, b</span><br></pre></td></tr></table></figure>
<p>并且可以通过 <code>a[b][0]</code> 与 <code>a</code> 是相同的对象来证明是循环引用</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[b][<span class="number">0</span>] <span class="keyword">is</span> a</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<hr>
<h2 id="Section-Appearances-are-deceptive-外表是靠不住的">Section: Appearances are deceptive!/外表是靠不住的!</h2>
<h3 id="Skipping-lines-跳过一行">&gt; Skipping lines?/跳过一行?</h3>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>value = <span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>valuе = <span class="number">32</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>value</span><br><span class="line"><span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>什么鬼?</p>
<p><strong>注意:</strong> 如果你想要重现的话最简单的方法是直接复制上面的代码片段到你的文件或命令行里.</p>
<h4 id="💡-说明-27">💡 说明:</h4>
<p>一些非西方字符虽然看起来和英语字母相同, 但会被解释器识别为不同的字母.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;е&#x27;</span>) <span class="comment"># 西里尔语的 &#x27;e&#x27; (Ye)</span></span><br><span class="line"><span class="number">1077</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;e&#x27;</span>) <span class="comment"># 拉丁语的 &#x27;e&#x27;, 用于英文并使用标准键盘输入</span></span><br><span class="line"><span class="number">101</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;е&#x27;</span> == <span class="string">&#x27;e&#x27;</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>value = <span class="number">42</span> <span class="comment"># 拉丁语 e</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>valuе = <span class="number">23</span> <span class="comment"># 西里尔语 &#x27;e&#x27;, Python 2.x 的解释器在这会抛出 `SyntaxError` 异常</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>value</span><br><span class="line"><span class="number">42</span></span><br></pre></td></tr></table></figure>
<p>内置的 <code>ord()</code> 函数可以返回一个字符的 Unicode <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Code_point">代码点</a>, 这里西里尔语 ‘e’ 和拉丁语 ‘e’ 的代码点不同证实了上述例子.</p>
<hr>
<h3 id="Teleportation-空间移动">&gt; Teleportation/空间移动 *</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">energy_send</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="comment"># 初始化一个 numpy 数组</span></span><br><span class="line">    np.array([<span class="built_in">float</span>(x)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">energy_receive</span>():</span><br><span class="line">    <span class="comment"># 返回一个空的 numpy 数组</span></span><br><span class="line">    <span class="keyword">return</span> np.empty((), dtype=np.<span class="built_in">float</span>).tolist()</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>energy_send(<span class="number">123.456</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>energy_receive()</span><br><span class="line"><span class="number">123.456</span></span><br></pre></td></tr></table></figure>
<p>谁来给我发个诺贝尔奖?</p>
<h4 id="💡-说明-28">💡 说明:</h4>
<ul>
<li>注意在 <code>energy_send</code> 函数中创建的 numpy 数组并没有返回, 因此内存空间被释放并可以被重新分配.</li>
<li><code>numpy.empty()</code> 直接返回下一段空闲内存，而不重新初始化. 而这个内存点恰好就是刚刚释放的那个(通常情况下, 并不绝对).</li>
</ul>
<hr>
<h3 id="Well-something-is-fishy…-嗯，有些可疑…">&gt; Well, something is fishy…/嗯，有些可疑…</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    一个通过加法计算平方的简单函数.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    sum_so_far = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> counter <span class="keyword">in</span> <span class="built_in">range</span>(x):</span><br><span class="line">        sum_so_far = sum_so_far + x</span><br><span class="line">  <span class="keyword">return</span> sum_so_far</span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>square(<span class="number">10</span>)</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>难道不应该是 100 吗?</p>
<p><strong>注意:</strong> 如果你无法重现, 可以尝试运行这个文件<a href="/mixed_tabs_and_spaces.py">mixed_tabs_and_spaces.py</a>.</p>
<h4 id="💡-说明-29">💡 说明:</h4>
<ul>
<li>
<p><strong>不要混用制表符(tab)和空格(space)!</strong> 在上面的例子中, return 的前面是&quot;1 个制表符&quot;, 而其他部分的代码前面是 “4 个空格”.</p>
</li>
<li>
<p>Python 是这么处理制表符的:</p>
<blockquote>
<p>首先, 制表符会从左到右依次被替换成 8 个空格, 直到被替换后的字符总数是八的倍数 &lt;…&gt;</p>
</blockquote>
</li>
<li>
<p>因此, <code>square</code> 函数最后一行的制表符会被替换成 8 个空格, 导致 return 语句进入循环语句里面.</p>
</li>
<li>
<p>Python 3 很友好, 在这种情况下会自动抛出错误.</p>
<p><strong>Output (Python 3.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TabError: inconsistent use of tabs <span class="keyword">and</span> spaces <span class="keyword">in</span> indentation</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<hr>
<h2 id="Section-Watch-out-for-the-landmines-小心地雷">Section: Watch out for the landmines!/小心地雷!</h2>
<h3 id="Modifying-a-dictionary-while-iterating-over-it-迭代字典时的修改">&gt; Modifying a dictionary while iterating over it/迭代字典时的修改</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = &#123;<span class="number">0</span>: <span class="literal">None</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">    <span class="keyword">del</span> x[i]</span><br><span class="line">    x[i+<span class="number">1</span>] = <span class="literal">None</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 2.7- Python 3.5):</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td></tr></table></figure>
<p>是的, 它运行了<strong>八次</strong>然后才停下来.</p>
<h4 id="💡-说明-30">💡 说明:</h4>
<ul>
<li>Python 不支持对字典进行迭代的同时修改它.</li>
<li>它之所以运行 8 次, 是因为字典会自动扩容以容纳更多键值(我们有 8 次删除记录, 因此需要扩容). 这实际上是一个实现细节. (译: 应该是因为字典的初始最小值是 8, 扩容会导致散列表地址发生变化而中断循环.)</li>
<li>在不同的 Python 实现中删除键的处理方式以及调整大小的时间可能会有所不同.(译: 就是说什么时候扩容在不同版本中可能是不同的, 在 3.6 及 3.7 的版本中到<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/v3.6.1/Objects/dictobject.c#L103-L110">5</a>就会自动扩容了. 以后也有可能再次发生变化. 这是为了避免散列冲突. 顺带一提, 后面两次扩容会扩展为 32 和 256. 即<code>8-&gt;32-&gt;256</code>.)</li>
<li>更多的信息, 你可以参考这个 StackOverflow 的<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/44763802/bug-in-python-dict">回答</a>, 它详细的解释一个类似的例子.</li>
</ul>
<hr>
<h3 id="Stubborn-del-operator-坚强的-del">&gt; Stubborn <code>del</code> operator/坚强的 <code>del</code> *</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Deleted!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong><br>
1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = SomeClass()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> x <span class="comment"># 这里应该会输出 &quot;Deleted!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> y</span><br><span class="line">Deleted!</span><br></pre></td></tr></table></figure>
<p>唷, 终于删除了. 你可能已经猜到了在我们第一次尝试删除 <code>x</code> 时是什么让 <code>__del__</code> 免于被调用的. 那让我们给这个例子增加点难度.</p>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = SomeClass()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y <span class="comment"># 检查一下y是否存在</span></span><br><span class="line">&lt;__main__.SomeClass instance at <span class="number">0x7f98a1a67fc8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> y <span class="comment"># 像之前一样, 这里应该会输出 &quot;Deleted!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">globals</span>() <span class="comment"># 好吧, 并没有. 让我们看一下所有的全局变量</span></span><br><span class="line">Deleted!</span><br><span class="line">&#123;<span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;__builtin__&#x27;</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">&#x27;SomeClass&#x27;</span>: &lt;<span class="keyword">class</span> <span class="title class_">__main__</span>.SomeClass at <span class="number">0x7f98a1a5f668</span>&gt;, <span class="string">&#x27;__package__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure>
<p>好了，现在它被删除了 😕</p>
<h4 id="💡-说明-31">💡 说明:</h4>
<ul>
<li><code>del x</code> 并不会立刻调用 <code>x.__del__()</code>.</li>
<li>每当遇到 <code>del x</code>, Python 会将 <code>x</code> 的引用数减 1, 当 <code>x</code> 的引用数减到 0 时就会调用 <code>x.__del__()</code>.</li>
<li>在第二个例子中, <code>y.__del__()</code> 之所以未被调用, 是因为前一条语句 (<code>&gt;&gt;&gt; y</code>) 对同一对象创建了另一个引用, 从而防止在执行 <code>del y</code> 后对象的引用数变为 0.</li>
<li>调用 <code>globals</code> 导致引用被销毁, 因此我们可以看到 “Deleted!” 终于被输出了.</li>
<li>(译: 这其实是 Python 交互解释器的特性, 它会自动让 <code>_</code> 保存上一个表达式输出的值, 详细可以看<a target="_blank" rel="noopener" href="https://www.cnblogs.com/leisurelylicht/p/diao-pi-de-kong-zhi-tai.html">这里</a>.)</li>
</ul>
<hr>
<h3 id="Deleting-a-list-item-while-iterating-迭代列表时删除元素">&gt; Deleting a list item while iterating/迭代列表时删除元素</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">list_1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">list_2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">list_3 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">list_4 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(list_1):</span><br><span class="line">    <span class="keyword">del</span> item</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(list_2):</span><br><span class="line">    list_2.remove(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(list_3[:]):</span><br><span class="line">    list_3.remove(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(list_4):</span><br><span class="line">    list_4.pop(idx)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>list_1</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list_2</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list_3</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list_4</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>你能猜到为什么输出是 <code>[2, 4]</code> 吗?</p>
<h4 id="💡-说明-32">💡 说明:</h4>
<ul>
<li>
<p>在迭代时修改对象是一个很愚蠢的主意. 正确的做法是迭代对象的副本, <code>list_3[:]</code> 就是这么做的.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(some_list)</span><br><span class="line"><span class="number">139798789457608</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(some_list[:]) <span class="comment"># 注意python为切片列表创建了新对象.</span></span><br><span class="line"><span class="number">139798779601192</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><code>del</code>, <code>remove</code> 和 <code>pop</code> 的不同:</strong></p>
<ul>
<li><code>del var_name</code> 只是从本地或全局命名空间中删除了 <code>var_name</code> (这就是为什么 <code>list_1</code> 没有受到影响).</li>
<li><code>remove</code> 会删除第一个匹配到的指定值, 而不是特定的索引, 如果找不到值则抛出 <code>ValueError</code> 异常.</li>
<li><code>pop</code> 则会删除指定索引处的元素并返回它, 如果指定了无效的索引则抛出 <code>IndexError</code> 异常.</li>
</ul>
<p><strong>为什么输出是 <code>[2, 4]</code>?</strong></p>
<ul>
<li>列表迭代是按索引进行的, 所以当我们从 <code>list_2</code> 或 <code>list_4</code> 中删除 <code>1</code> 时, 列表的内容就变成了 <code>[2, 3, 4]</code>. 剩余元素会依次位移, 也就是说, <code>2</code> 的索引会变为 0, <code>3</code> 会变为 1. 由于下一次迭代将获取索引为 1 的元素 (即 <code>3</code>), 因此 <code>2</code> 将被彻底的跳过. 类似的情况会交替发生在列表中的每个元素上.</li>
</ul>
<ul>
<li>参考这个 StackOverflow 的<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45946228/what-happens-when-you-try-to-delete-a-list-element-while-iterating-over-it">回答</a>来解释这个例子</li>
<li>关于 Python 中字典的类似例子, 可以参考这个 Stackoverflow 的<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45877614/how-to-change-all-the-dictionary-keys-in-a-for-loop-with-d-items">回答</a>.</li>
</ul>
<hr>
<h3 id="Loop-variables-leaking-out-循环变量泄漏">&gt; Loop variables leaking out!/循环变量泄漏!</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">6</span>:</span><br><span class="line">        <span class="built_in">print</span>(x, <span class="string">&#x27;: for x inside loop&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(x, <span class="string">&#x27;: x in global&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6</span> : <span class="keyword">for</span> x inside loop</span><br><span class="line"><span class="number">6</span> : x <span class="keyword">in</span> <span class="keyword">global</span></span><br></pre></td></tr></table></figure>
<p>但是 <code>x</code> 从未在循环外被定义…</p>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这次我们先初始化x</span></span><br><span class="line">x = -<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">6</span>:</span><br><span class="line">        <span class="built_in">print</span>(x, <span class="string">&#x27;: for x inside loop&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(x, <span class="string">&#x27;: x in global&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6</span> : <span class="keyword">for</span> x inside loop</span><br><span class="line"><span class="number">6</span> : x <span class="keyword">in</span> <span class="keyword">global</span></span><br></pre></td></tr></table></figure>
<p>3.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = 1</span><br><span class="line">print([x for x in range(5)])</span><br><span class="line">print(x, &#x27;: x in global&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Output (on Python 2.x):</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[0, 1, 2, 3, 4]</span><br><span class="line">(4, &#x27;: x in global&#x27;)</span><br></pre></td></tr></table></figure>
<p><strong>Output (on Python 3.x):</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[0, 1, 2, 3, 4]</span><br><span class="line">1 : x in global</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-33">💡 说明:</h4>
<ul>
<li>
<p>在 Python 中, for 循环使用所在作用域并在结束后保留定义的循环变量. 如果我们曾在全局命名空间中定义过循环变量. 在这种情况下, 它会重新绑定现有变量.</p>
</li>
<li>
<p>Python 2.x 和 Python 3.x 解释器在列表推导式示例中的输出差异, 在文档 <a target="_blank" rel="noopener" href="https://docs.python.org/3/whatsnew/3.0.html">What’s New In Python 3.0</a> 中可以找到相关的解释:</p>
<blockquote>
<p>“列表推导不再支持句法形式 <code>[... for var in item1, item2, ...]</code>. 取而代之的是 <code>[... for var in (item1, item2, ...)]</code>. 另外, 注意列表推导具有不同的语义: 它们更接近于 <code>list()</code> 构造函数中生成器表达式的语法糖(译: 这一句我也不是很明白), 特别是循环控制变量不再泄漏到周围的作用域中.”</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="Beware-of-default-mutable-arguments-当心默认的可变参数">&gt; Beware of default mutable arguments!/当心默认的可变参数!</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">some_func</span>(<span class="params">default_arg=[]</span>):</span><br><span class="line">    default_arg.append(<span class="string">&quot;some_string&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> default_arg</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func()</span><br><span class="line">[<span class="string">&#x27;some_string&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func()</span><br><span class="line">[<span class="string">&#x27;some_string&#x27;</span>, <span class="string">&#x27;some_string&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func([])</span><br><span class="line">[<span class="string">&#x27;some_string&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func()</span><br><span class="line">[<span class="string">&#x27;some_string&#x27;</span>, <span class="string">&#x27;some_string&#x27;</span>, <span class="string">&#x27;some_string&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-34">💡 说明:</h4>
<ul>
<li>
<p>Python 中函数的默认可变参数并不是每次调用该函数时都会被初始化. 相反, 它们会使用最近分配的值作为默认值. 当我们明确的将 <code>[]</code> 作为参数传递给 <code>some_func</code> 的时候, 就不会使用 <code>default_arg</code> 的默认值, 所以函数会返回我们所期望的结果.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">some_func</span>(<span class="params">default_arg=[]</span>):</span><br><span class="line">    default_arg.append(<span class="string">&quot;some_string&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> default_arg</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func.__defaults__ <span class="comment"># 这里会显示函数的默认参数的值</span></span><br><span class="line">([],)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func.__defaults__</span><br><span class="line">([<span class="string">&#x27;some_string&#x27;</span>],)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func.__defaults__</span><br><span class="line">([<span class="string">&#x27;some_string&#x27;</span>, <span class="string">&#x27;some_string&#x27;</span>],)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func([])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func.__defaults__</span><br><span class="line">([<span class="string">&#x27;some_string&#x27;</span>, <span class="string">&#x27;some_string&#x27;</span>],)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>避免可变参数导致的错误的常见做法是将 <code>None</code> 指定为参数的默认值, 然后检查是否有值传给对应的参数. 例:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">some_func</span>(<span class="params">default_arg=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> default_arg:</span><br><span class="line">        default_arg = []</span><br><span class="line">    default_arg.append(<span class="string">&quot;some_string&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> default_arg</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Catching-the-Exceptions-捕获异常">&gt; Catching the Exceptions/捕获异常</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">some_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 这里会抛出异常 ``IndexError``</span></span><br><span class="line">    <span class="built_in">print</span>(some_list[<span class="number">4</span>])</span><br><span class="line"><span class="keyword">except</span> IndexError, ValueError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Caught!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 这里会抛出异常 ``ValueError``</span></span><br><span class="line">    some_list.remove(<span class="number">4</span>)</span><br><span class="line"><span class="keyword">except</span> IndexError, ValueError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Caught again!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Caught!</span><br><span class="line"></span><br><span class="line">ValueError: <span class="built_in">list</span>.remove(x): x <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">list</span></span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 3.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  File <span class="string">&quot;&lt;input&gt;&quot;</span>, line <span class="number">3</span></span><br><span class="line">    <span class="keyword">except</span> IndexError, ValueError:</span><br><span class="line">                     ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-35">💡 说明:</h4>
<ul>
<li>
<p>如果你想要同时捕获多个不同类型的异常时, 你需要将它们用括号包成一个元组作为第一个参数传递. 第二个参数是可选名称, 如果你提供, 它将与被捕获的异常实例绑定. 例,</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">some_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># 这里会抛出异常 ``ValueError``</span></span><br><span class="line">   some_list.remove(<span class="number">4</span>)</span><br><span class="line"><span class="keyword">except</span> (IndexError, ValueError), e:</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;Caught again!&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Caught again!</span><br><span class="line">list.remove(x): x not in list</span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 3.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  File <span class="string">&quot;&lt;input&gt;&quot;</span>, line <span class="number">4</span></span><br><span class="line">    <span class="keyword">except</span> (IndexError, ValueError), e:</span><br><span class="line">                                     ^</span><br><span class="line">IndentationError: unindent does <span class="keyword">not</span> <span class="keyword">match</span> <span class="built_in">any</span> outer indentation level</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在 Python 3 中, 用逗号区分异常与可选名称是无效的; 正确的做法是使用 <code>as</code> 关键字. 例,</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">some_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    some_list.remove(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> (IndexError, ValueError) <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Caught again!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Caught again!</span><br><span class="line">list.remove(x): x not in list</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Same-operands-different-story-同人不同命">&gt; Same operands, different story!/同人不同命!</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">b = a</span><br><span class="line">a = a + [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">b = a</span><br><span class="line">a += [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-36">💡 说明:</h4>
<ul>
<li>
<p><code>a += b</code> 并不总是与 <code>a = a + b</code> 表现相同. 类实现 <em><code>op=</code></em> 运算符的方式 <em>也许</em> 是不同的, 列表就是这样做的.</p>
</li>
<li>
<p>表达式 <code>a = a + [5,6,7,8]</code> 会生成一个新列表, 并让 <code>a</code> 引用这个新列表, 同时保持 <code>b</code> 不变.</p>
</li>
<li>
<p>表达式 <code>a += [5,6,7,8]</code> 实际上是使用的是 “extend” 函数, 所以 <code>a</code> 和 <code>b</code> 仍然指向已被修改的同一列表.</p>
</li>
</ul>
<hr>
<h3 id="The-out-of-scope-variable-外部作用域变量">&gt; The out of scope variable/外部作用域变量</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">some_func</span>():</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">another_func</span>():</span><br><span class="line">    a += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_func()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_func()</span><br><span class="line">UnboundLocalError: local variable <span class="string">&#x27;a&#x27;</span> referenced before assignment</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-37">💡 说明:</h4>
<ul>
<li>
<p>当你在作用域中对变量进行赋值时, 变量会变成该作用域内的局部变量. 因此 <code>a</code> 会变成 <code>another_func</code> 函数作用域中的局部变量, 但它在函数作用域中并没有被初始化, 所以会引发错误.</p>
</li>
<li>
<p>可以阅读<a target="_blank" rel="noopener" href="http://sebastianraschka.com/Articles/2014_python_scope_and_namespaces.html">这个</a>简短却很棒的指南, 了解更多关于 Python 中命名空间和作用域的工作原理.</p>
</li>
<li>
<p>想要在 <code>another_func</code> 中修改外部作用域变量 <code>a</code> 的话, 可以使用 <code>global</code> 关键字.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">another_func</span>()</span><br><span class="line">    <span class="keyword">global</span> a</span><br><span class="line">    a += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>another_func()</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Be-careful-with-chained-operations-小心链式操作">&gt; Be careful with chained operations/小心链式操作</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="literal">False</span> == <span class="literal">False</span>) <span class="keyword">in</span> [<span class="literal">False</span>] <span class="comment"># 可以理解</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">False</span> == (<span class="literal">False</span> <span class="keyword">in</span> [<span class="literal">False</span>]) <span class="comment"># 可以理解</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">False</span> == <span class="literal">False</span> <span class="keyword">in</span> [<span class="literal">False</span>] <span class="comment"># 为毛?</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">True</span> <span class="keyword">is</span> <span class="literal">False</span> == <span class="literal">False</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">False</span> <span class="keyword">is</span> <span class="literal">False</span> <span class="keyword">is</span> <span class="literal">False</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> &gt; <span class="number">0</span> &lt; <span class="number">1</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(<span class="number">1</span> &gt; <span class="number">0</span>) &lt; <span class="number">1</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> &gt; (<span class="number">0</span> &lt; <span class="number">1</span>)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-38">💡 说明:</h4>
<p>根据 <a target="_blank" rel="noopener" href="https://docs.python.org/2/reference/expressions.html#not-in">https://docs.python.org/2/reference/expressions.html#not-in</a></p>
<blockquote>
<p>形式上, 如果 a, b, c, …, y, z 是表达式, 而 op1, op2, …, opN 是比较运算符, 那么除了每个表达式最多只出现一次以外 a op1 b op2 c … y opN z 就等于 a op1 b and b op2 c and … y opN z.</p>
</blockquote>
<p>虽然上面的例子似乎很愚蠢, 但是像 <code>a == b == c</code> 或 <code>0 &lt;= x &lt;= 100</code> 就很棒了.</p>
<ul>
<li><code>False is False is False</code> 相当于 <code>(False is False) and (False is False)</code></li>
<li><code>True is False == False</code> 相当于 <code>True is False and False == False</code>, 由于语句的第一部分 (<code>True is False</code>) 等于 <code>False</code>, 因此整个表达式的结果为 <code>False</code>.</li>
<li><code>1 &gt; 0 &lt; 1</code> 相当于 <code>1 &gt; 0 and 0 &lt; 1</code>, 所以最终结果为 <code>True</code>.</li>
<li>表达式 <code>(1 &gt; 0) &lt; 1</code> 相当于 <code>True &lt; 1</code> 且<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="literal">True</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">True</span> + <span class="number">1</span> <span class="comment"># 与这个例子无关，只是好玩</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
所以, <code>1 &lt; 1</code> 等于 <code>False</code></li>
</ul>
<hr>
<h3 id="Name-resolution-ignoring-class-scope-忽略类作用域的名称解析">&gt; Name resolution ignoring class scope/忽略类作用域的名称解析</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">5</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>:</span><br><span class="line">    x = <span class="number">17</span></span><br><span class="line">    y = (x <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(SomeClass.y)[<span class="number">0</span>]</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">5</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeClass</span>:</span><br><span class="line">    x = <span class="number">17</span></span><br><span class="line">    y = [x <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 2.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>SomeClass.y[<span class="number">0</span>]</span><br><span class="line"><span class="number">17</span></span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 3.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>SomeClass.y[<span class="number">0</span>]</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-39">💡 说明:</h4>
<ul>
<li>类定义中嵌套的作用域会忽略类内的名称绑定.</li>
<li>生成器表达式有它自己的作用域.</li>
<li>从 Python 3.X 开始, 列表推导式也有自己的作用域.</li>
</ul>
<hr>
<h3 id="Needle-in-a-Haystack-大海捞针">&gt; Needle in a Haystack/大海捞针</h3>
<p>1.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x, y = (<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">if</span> <span class="literal">True</span> <span class="keyword">else</span> <span class="literal">None</span>, <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x, y  # 期望的结果是 (0, 1)</span><br><span class="line">((0, 1), None)</span><br></pre></td></tr></table></figure>
<p>几乎每个 Python 程序员都遇到过类似的情况.</p>
<p>2.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">t = (<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">t = (<span class="string">&#x27;one&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">t = ()</span><br><span class="line"><span class="built_in">print</span>(t)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">one</span><br><span class="line">two</span><br><span class="line">o</span><br><span class="line">n</span><br><span class="line">e</span><br><span class="line"><span class="built_in">tuple</span>()</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-40">💡 说明:</h4>
<ul>
<li>对于 1, 正确的语句是 <code>x, y = (0, 1) if True else (None, None)</code>.</li>
<li>对于 2, 正确的语句是 <code>t = ('one',)</code> 或者 <code>t = 'one',</code> (缺少逗号) 否则解释器会认为 <code>t</code> 是一个字符串, 并逐个字符对其进行迭代.</li>
<li><code>()</code> 是一个特殊的标记，表示空元组.</li>
</ul>
<hr>
<hr>
<h2 id="Section-The-Hidden-treasures-隐藏的宝藏">Section: The Hidden treasures!/隐藏的宝藏!</h2>
<p>This section contains few of the lesser-known interesting things about Python that most beginners like me are unaware of (well, not anymore).</p>
<h3 id="Okay-Python-Can-you-make-me-fly-Python-可否带我飞">&gt; Okay Python, Can you make me fly?/Python, 可否带我飞? *</h3>
<p>好, 去吧.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> antigravity</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong><br>
嘘… 这是个超级秘密.</p>
<h4 id="💡-说明-41">💡 说明:</h4>
<ul>
<li><code>antigravity</code> 模块是 Python 开发人员发布的少数复活节彩蛋之一.</li>
<li><code>import antigravity</code> 会打开一个 Python 的<a target="_blank" rel="noopener" href="http://xkcd.com/353/">经典 XKCD 漫画</a>页面.</li>
<li>不止如此. 这个<strong>复活节彩蛋里还有一个复活节彩蛋</strong>. 如果你看一下<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/master/Lib/antigravity.py#L7-L17">代码</a>, 就会发现还有一个函数实现了 <a target="_blank" rel="noopener" href="https://xkcd.com/426/">XKCD’s geohashing 算法</a>.</li>
</ul>
<hr>
<h3 id="goto-but-why-goto-但为什么">&gt; <code>goto</code>, but why?/<code>goto</code>, 但为什么? *</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> goto <span class="keyword">import</span> goto, label</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;I&#x27;m trapped, please rescue!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> k == <span class="number">2</span>:</span><br><span class="line">                goto .breakout <span class="comment"># 从多重循环中跳出</span></span><br><span class="line">label .breakout</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Freedom!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output (Python 2.3):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I<span class="string">&#x27;m trapped, please rescue!</span></span><br><span class="line"><span class="string">I&#x27;</span>m trapped, please rescue!</span><br><span class="line">Freedom!</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-42">💡 说明:</h4>
<ul>
<li>2004 年 4 月 1 日, Python <a target="_blank" rel="noopener" href="https://mail.python.org/pipermail/python-announce-list/2004-April/002982.html">宣布</a> 加入一个可用的 <code>goto</code> 作为愚人节礼物.</li>
<li>当前版本的 Python 并没有这个模块.</li>
<li>就算可以用, 也请不要使用它. 这里是为什么 Python 中没有 <code>goto</code> 的<a target="_blank" rel="noopener" href="https://docs.python.org/3/faq/design.html#why-is-there-no-goto">原因</a>.</li>
</ul>
<hr>
<h3 id="Brace-yourself-做好思想准备">&gt; Brace yourself!/做好思想准备 *</h3>
<p>如果你不喜欢在 Python 中使用空格来表示作用域, 你可以导入 C 风格的 {},</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> braces</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  File <span class="string">&quot;some_file.py&quot;</span>, line <span class="number">1</span></span><br><span class="line">    <span class="keyword">from</span> __future__ <span class="keyword">import</span> braces</span><br><span class="line">SyntaxError: <span class="keyword">not</span> a chance</span><br></pre></td></tr></table></figure>
<p>想用大括号? 没门! 觉得不爽, 请去用 java.</p>
<h4 id="💡-说明-43">💡 说明:</h4>
<ul>
<li>通常 <code>__future__</code> 会提供 Python 未来版本的功能. 然而，这里的 “未来” 是一个讽刺.</li>
<li>这是一个表达社区对此类问题态度的复活节彩蛋.</li>
</ul>
<hr>
<h3 id="Let’s-meet-Friendly-Language-Uncle-For-Life-让生活更友好">&gt; Let’s meet Friendly Language Uncle For Life/让生活更友好 *</h3>
<p><strong>Output (Python 3.x)</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> __future__ <span class="keyword">import</span> barry_as_FLUFL</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;Ruby&quot;</span> != <span class="string">&quot;Python&quot;</span> <span class="comment"># 这里没什么疑问</span></span><br><span class="line">  File <span class="string">&quot;some_file.py&quot;</span>, line <span class="number">1</span></span><br><span class="line">    <span class="string">&quot;Ruby&quot;</span> != <span class="string">&quot;Python&quot;</span></span><br><span class="line">              ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;Ruby&quot;</span> &lt;&gt; <span class="string">&quot;Python&quot;</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>这就对了.</p>
<h4 id="💡-说明-44">💡 说明:</h4>
<ul>
<li>相关的 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0401/">PEP-401</a> 发布于 2009 年 4 月 1 日 (所以你现在知道这意味着什么了吧).</li>
<li>引用 PEP-401
<blockquote>
<p>意识到 Python 3.0 里的 != 运算符是一个会引起手指疼痛的恐怖错误, FLUFL 将 &lt;&gt; 运算符恢复为唯一写法.</p>
</blockquote>
</li>
<li>Uncle Barry 在 PEP 中还分享了其他东西; 你可以在<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0401/">这里</a>获得他们.</li>
<li>(译: 虽然文档中没写，但应该是只能在交互解释器中使用.)</li>
</ul>
<hr>
<h3 id="Even-Python-understands-that-love-is-complicated-连-Python-也知道爱是难言的">&gt; Even Python understands that love is complicated/连 Python 也知道爱是难言的 *</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> this</span><br></pre></td></tr></table></figure>
<p>等等, <strong>this</strong> 是什么? <code>this</code> 是爱 ❤️</p>
<p><strong>Output:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">The Zen of Python, by Tim Peters</span><br><span class="line"></span><br><span class="line">Beautiful is better than ugly.</span><br><span class="line">优美胜于丑陋（Python 以编写优美的代码为目标）</span><br><span class="line">Explicit is better than implicit.</span><br><span class="line">明了胜于晦涩（优美的代码应当是明了的，命名规范，风格相似）</span><br><span class="line">Simple is better than complex.</span><br><span class="line">简洁胜于复杂（优美的代码应当是简洁的，不要有复杂的内部实现）</span><br><span class="line">Complex is better than complicated.</span><br><span class="line">复杂胜于凌乱（如果复杂不可避免，那代码间也不能有难懂的关系，要保持接口简洁）</span><br><span class="line">Flat is better than nested.</span><br><span class="line">扁平胜于嵌套（优美的代码应当是扁平的，不能有太多的嵌套）</span><br><span class="line">Sparse is better than dense.</span><br><span class="line">间隔胜于紧凑（优美的代码有适当的间隔，不要奢望一行代码解决问题）</span><br><span class="line">Readability counts.</span><br><span class="line">可读性很重要（优美的代码一定是可读的）</span><br><span class="line">Special cases aren&#x27;t special enough to break the rules.</span><br><span class="line">没有特例特殊到需要违背这些规则（这些规则至高无上）</span><br><span class="line">Although practicality beats purity.</span><br><span class="line">尽管我们更倾向于实用性</span><br><span class="line">Errors should never pass silently.</span><br><span class="line">不要安静的包容所有错误</span><br><span class="line">Unless explicitly silenced.</span><br><span class="line">除非你确定需要这样做（精准地捕获异常，不写 except:pass 风格的代码）</span><br><span class="line">In the face of ambiguity, refuse the temptation to guess.</span><br><span class="line">拒绝诱惑你去猜测的暧昧事物</span><br><span class="line">There should be one-- and preferably only one --obvious way to do it.</span><br><span class="line">而是尽量找一种，最好是唯一一种明显的解决方案（如果不确定，就用穷举法）</span><br><span class="line">Although that way may not be obvious at first unless you&#x27;re Dutch.</span><br><span class="line">虽然这并不容易，因为你不是 Python 之父（这里的 Dutch 是指 Guido ）</span><br><span class="line">Now is better than never.</span><br><span class="line">现在行动好过永远不行动</span><br><span class="line">Although never is often better than *right* now.</span><br><span class="line">尽管不行动要好过鲁莽行动</span><br><span class="line">If the implementation is hard to explain, it&#x27;s a bad idea.</span><br><span class="line">如果你无法向人描述你的方案，那肯定不是一个好方案；</span><br><span class="line">If the implementation is easy to explain, it may be a good idea.</span><br><span class="line">如果你能轻松向人描述你的方案，那也许会是一个好方案（方案测评标准）</span><br><span class="line">Namespaces are one honking great idea -- let&#x27;s do more of those!</span><br><span class="line">命名空间是一种绝妙的理念，我们应当多加利用（倡导与号召）</span><br></pre></td></tr></table></figure>
<p>这是 Python 之禅!</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>love = this</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>this <span class="keyword">is</span> love</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>love <span class="keyword">is</span> <span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>love <span class="keyword">is</span> <span class="literal">False</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>love <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">True</span> <span class="keyword">or</span> <span class="literal">False</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>love <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">True</span> <span class="keyword">or</span> <span class="literal">False</span>; love <span class="keyword">is</span> love  <span class="comment"># 爱是难言的</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-45">💡 说明:</h4>
<ul>
<li>
<p><code>this</code> 模块是关于 Python 之禅的复活节彩蛋 (<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0020">PEP 20</a>).</p>
</li>
<li>
<p>如果你认为这已经够有趣的了, 可以看看 <a target="_blank" rel="noopener" href="https://hg.python.org/cpython/file/c3896275c0f6/Lib/this.py">this.py</a> 的实现. 有趣的是, Python 之禅的实现代码违反了他自己 (这可能是唯一会发生这种情况的地方).</p>
</li>
<li>
<p>至于 <code>love is not True or False; love is love</code>, 意外却又不言而喻.</p>
<hr>
</li>
</ul>
<h3 id="Yes-it-exists-是的-它存在">&gt; Yes, it exists!/是的, 它存在!</h3>
<p><strong>循环的 <code>else</code>.</strong> 一个典型的例子:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">does_exists_num</span>(<span class="params">l, to_find</span>):</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> l:</span><br><span class="line">        <span class="keyword">if</span> num == to_find:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Exists!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Does not exist&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>does_exists_num(some_list, <span class="number">4</span>)</span><br><span class="line">Exists!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>does_exists_num(some_list, -<span class="number">1</span>)</span><br><span class="line">Does <span class="keyword">not</span> exist</span><br></pre></td></tr></table></figure>
<p><strong>异常的 <code>else</code> .</strong> 例,</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Exception occurred!!!&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Try block executed successfully...&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Try block executed successfully...</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-46">💡 说明:</h4>
<ul>
<li>循环后的 <code>else</code> 子句只会在循环没有触发 <code>break</code> 语句, 正常结束的情况下才会执行.</li>
<li>try 之后的 <code>else</code> 子句也被称为 “完成子句”, 因为在 <code>try</code> 语句中到达 <code>else</code> 子句意味着 try 块实际上已成功完成.</li>
</ul>
<hr>
<h3 id="Inpinity-无限">&gt; Inpinity/无限 *</h3>
<p>英文拼写是有意的, 请不要为此提交补丁.<br>
(译: 这里是为了突出 Python 中无限的定义与<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pi">Pi</a>有关, 所以将两个单词拼接了.)</p>
<p><strong>Output (Python 3.x):</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>infinity = <span class="built_in">float</span>(<span class="string">&#x27;infinity&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hash</span>(infinity)</span><br><span class="line"><span class="number">314159</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hash</span>(<span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>))</span><br><span class="line">-<span class="number">314159</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-47">💡 说明:</h4>
<ul>
<li>infinity 的哈希值是 10⁵ x π.</li>
<li>有意思的是, <code>float('-inf')</code> 的哈希值在 Python 3 中是 “-10⁵ x π” , 而在 Python 2 中是 “-10⁵ x e”.</li>
</ul>
<hr>
<h3 id="Mangling-time-修饰时间">&gt; Mangling time!/修饰时间! *</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Yo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.__honey = <span class="literal">True</span></span><br><span class="line">        self.bitch = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Yo().bitch</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Yo().__honey</span><br><span class="line">AttributeError: <span class="string">&#x27;Yo&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;__honey&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Yo()._Yo__honey</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>为什么 <code>Yo()._Yo__honey</code> 能运行? 只有印度人理解.(译: 这个梗可能是指印度音乐人<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Yo_Yo_Honey_Singh">Yo Yo Honey Singh</a>)</p>
<h4 id="💡-说明-48">💡 说明:</h4>
<ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Name_mangling">名字修饰</a> 用于避免不同命名空间之间名称冲突.</li>
<li>在 Python 中, 解释器会通过给类中以 <code>__</code> (双下划线)开头且结尾最多只有一个下划线的类成员名称加上<code>_NameOfTheClass</code> 来修饰(mangles)名称.</li>
<li>所以, 要访问 <code>__honey</code> 对象,我们需要加上 <code>_Yo</code> 以防止与其他类中定义的相同名称的属性发生冲突.</li>
</ul>
<hr>
<hr>
<h2 id="Section-Miscellaneous-杂项">Section: Miscellaneous/杂项</h2>
<h3 id="is-faster-更快的">&gt; <code>+=</code> is faster/更快的 <code>+=</code></h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用 &quot;+&quot; 连接三个字符串:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">&quot;s1 = s1 + s2 + s3&quot;</span>, setup=<span class="string">&quot;s1 = &#x27; &#x27; * 100000; s2 = &#x27; &#x27; * 100000; s3 = &#x27; &#x27; * 100000&quot;</span>, number=<span class="number">100</span>)</span><br><span class="line"><span class="number">0.25748300552368164</span></span><br><span class="line"><span class="comment"># 用 &quot;+=&quot; 连接三个字符串:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="string">&quot;s1 += s2 + s3&quot;</span>, setup=<span class="string">&quot;s1 = &#x27; &#x27; * 100000; s2 = &#x27; &#x27; * 100000; s3 = &#x27; &#x27; * 100000&quot;</span>, number=<span class="number">100</span>)</span><br><span class="line"><span class="number">0.012188911437988281</span></span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-49">💡 说明:</h4>
<ul>
<li>连接两个以上的字符串时 <code>+=</code> 比 <code>+</code> 更快, 因为在计算过程中第一个字符串 (例如, <code>s1 += s2 + s3</code> 中的 <code>s1</code>) 不会被销毁.(译: 就是 <code>+=</code> 执行的是追加操作，少了一个销毁新建的动作.)</li>
</ul>
<hr>
<h3 id="Let’s-make-a-giant-string-来做个巨大的字符串吧！">&gt; Let’s make a giant string!/来做个巨大的字符串吧！</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_string_with_plus</span>(<span class="params">iters</span>):</span><br><span class="line">    s = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(iters):</span><br><span class="line">        s += <span class="string">&quot;xyz&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == <span class="number">3</span>*iters</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_bytes_with_plus</span>(<span class="params">iters</span>):</span><br><span class="line">    s = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(iters):</span><br><span class="line">        s += <span class="string">b&quot;xyz&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == <span class="number">3</span>*iters</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_string_with_format</span>(<span class="params">iters</span>):</span><br><span class="line">    fs = <span class="string">&quot;&#123;&#125;&quot;</span>*iters</span><br><span class="line">    s = fs.<span class="built_in">format</span>(*([<span class="string">&quot;xyz&quot;</span>]*iters))</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == <span class="number">3</span>*iters</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_string_with_join</span>(<span class="params">iters</span>):</span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(iters):</span><br><span class="line">        l.append(<span class="string">&quot;xyz&quot;</span>)</span><br><span class="line">    s = <span class="string">&quot;&quot;</span>.join(l)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == <span class="number">3</span>*iters</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_list_to_string</span>(<span class="params">l, iters</span>):</span><br><span class="line">    s = <span class="string">&quot;&quot;</span>.join(l)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == <span class="number">3</span>*iters</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="number">10000</span>))</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">972</span> µs per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_bytes_with_plus(<span class="number">10000</span>))</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">815</span> µs per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_format(<span class="number">10000</span>))</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">508</span> µs per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_join(<span class="number">10000</span>))</span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">878</span> µs per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="string">&quot;xyz&quot;</span>]*<span class="number">10000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(convert_list_to_string(l, <span class="number">10000</span>))</span><br><span class="line"><span class="number">10000</span> loops, best of <span class="number">3</span>: <span class="number">80</span> µs per loop</span><br></pre></td></tr></table></figure>
<p>让我们将迭代次数增加 10 倍.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="number">100000</span>)) <span class="comment"># 执行时间线性增加</span></span><br><span class="line"><span class="number">100</span> loops, best of <span class="number">3</span>: <span class="number">9.75</span> ms per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_bytes_with_plus(<span class="number">100000</span>)) <span class="comment"># 二次增加</span></span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">974</span> ms per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_format(<span class="number">100000</span>)) <span class="comment"># 线性增加</span></span><br><span class="line"><span class="number">100</span> loops, best of <span class="number">3</span>: <span class="number">5.25</span> ms per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_join(<span class="number">100000</span>)) <span class="comment"># 线性增加</span></span><br><span class="line"><span class="number">100</span> loops, best of <span class="number">3</span>: <span class="number">9.85</span> ms per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="string">&quot;xyz&quot;</span>]*<span class="number">100000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(convert_list_to_string(l, <span class="number">100000</span>)) <span class="comment"># 线性增加</span></span><br><span class="line"><span class="number">1000</span> loops, best of <span class="number">3</span>: <span class="number">723</span> µs per loop</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-50">💡 说明:</h4>
<ul>
<li>
<p>你可以在这获得更多 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/timeit.html">timeit</a> 的相关信息. 它通常用于衡量代码片段的执行时间.</p>
</li>
<li>
<p>不要用 <code>+</code> 去生成过长的字符串, 在 Python 中, <code>str</code> 是不可变的, 所以在每次连接中你都要把左右两个字符串复制到新的字符串中. 如果你连接四个长度为 10 的字符串, 你需要拷贝 (10+10) + ((10+10)+10) + (((10+10)+10)+10) = 90 个字符而不是 40 个字符. 随着字符串的数量和大小的增加, 情况会变得越发的糟糕 (就像<code>add_bytes_with_plus</code> 函数的执行时间一样)</p>
</li>
<li>
<p>因此, 更建议使用 <code>.format.</code> 或 <code>%</code> 语法 (但是, 对于短字符串, 它们比 <code>+</code> 稍慢一点).</p>
</li>
<li>
<p>又或者, 如果你所需的内容已经以可迭代对象的形式提供了, 使用 <code>''.join(可迭代对象)</code> 要快多了.</p>
</li>
<li>
<p><code>add_string_with_plus</code> 的执行时间没有像 <code>add_bytes_with_plus</code> 一样出现二次增加是因为解释器会如同上一个例子所讨论的一样优化 <code>+=</code>. 用 <code>s = s + &quot;x&quot; + &quot;y&quot; + &quot;z&quot;</code> 替代 <code>s += &quot;xyz&quot;</code> 的话, 执行时间就会二次增加了.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_string_with_plus</span>(<span class="params">iters</span>):</span><br><span class="line">    s = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(iters):</span><br><span class="line">        s = s + <span class="string">&quot;x&quot;</span> + <span class="string">&quot;y&quot;</span> + <span class="string">&quot;z&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s) == <span class="number">3</span>*iters</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="number">10000</span>))</span><br><span class="line"><span class="number">100</span> loops, best of <span class="number">3</span>: <span class="number">9.87</span> ms per loop</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>timeit(add_string_with_plus(<span class="number">100000</span>)) <span class="comment"># 执行时间二次增加</span></span><br><span class="line"><span class="number">1</span> loops, best of <span class="number">3</span>: <span class="number">1.09</span> s per loop</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Explicit-typecast-of-strings-字符串的显式类型转换">&gt; Explicit typecast of strings/字符串的显式类型转换</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line">b = <span class="built_in">float</span>(<span class="string">&#x27;nan&#x27;</span>)</span><br><span class="line">c = <span class="built_in">float</span>(<span class="string">&#x27;-iNf&#x27;</span>)  <span class="comment"># 这些字符串不区分大小写</span></span><br><span class="line">d = <span class="built_in">float</span>(<span class="string">&#x27;nan&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Output:</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">inf</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">nan</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line">-inf</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">float</span>(<span class="string">&#x27;some_other_string&#x27;</span>)</span><br><span class="line">ValueError: could <span class="keyword">not</span> convert string to <span class="built_in">float</span>: some_other_string</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a == -c <span class="comment">#inf==inf</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">None</span> == <span class="literal">None</span> <span class="comment"># None==None</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b == d <span class="comment">#但是 nan!=nan</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">50</span>/a</span><br><span class="line"><span class="number">0.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a/a</span><br><span class="line">nan</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">23</span> + b</span><br><span class="line">nan</span><br></pre></td></tr></table></figure>
<h4 id="💡-说明-51">💡 说明:</h4>
<p><code>'inf'</code> 和 <code>'nan'</code> 是特殊的字符串(不区分大小写), 当显示转换成 <code>float</code> 型时, 它们分别用于表示数学意义上的 “无穷大” 和 “非数字”.</p>
<hr>
<h3 id="Minor-Ones-小知识点">&gt; Minor Ones/小知识点</h3>
<ul>
<li>
<p><code>join()</code> 是一个字符串操作而不是列表操作. (第一次接触会觉得有点违反直觉)</p>
<p><strong>💡 说明:</strong><br>
如果 <code>join()</code> 是字符串方法 那么它就可以处理任何可迭代的对象(列表，元组，迭代器). 如果它是列表方法, 则必须在每种类型中单独实现. 另外, 在 <code>list</code> 对象的通用 API 中实现一个专用于字符串的方法没有太大的意义.</p>
</li>
<li>
<p>看着奇怪但能正确运行的语句:</p>
<ul>
<li><code>[] = ()</code> 语句在语义上是正确的 (解包一个空的 <code>tuple</code> 并赋值给 <code>list</code>)</li>
<li><code>'a'[0][0][0][0][0]</code> 在语义上也是正确的, 因为在 Python 中字符串同时也是<a target="_blank" rel="noopener" href="https://docs.python.org/3/glossary.html#term-sequence">序列</a>(可迭代对象支持使用整数索引访问元素).</li>
<li><code>3 --0-- 5 == 8</code> 和 <code>--5 == 5</code> 在语义上都是正确的, 且结果等于 <code>True</code>.(译: 3 减负 0 等于 3，再减负 5 相当于加 5 等于 8；负的负 5 等于 5.)</li>
</ul>
</li>
<li>
<p>鉴于 <code>a</code> 是一个数字, <code>++a</code> 和 <code>--a</code> 都是有效的 Python 语句, 但其效果与 C, C++ 或 Java 等不一样.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>++a</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>--a</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>
<p><strong>💡 说明:</strong></p>
<ul>
<li>python 里没有 <code>++</code> 操作符. 这其实是两个 <code>+</code> 操作符.</li>
<li><code>++a</code> 被解析为 <code>+(+a)</code> 最后等于 <code>a</code>. <code>--a</code> 同理.</li>
<li>这个 StackOverflow <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3654830/why-are-there-no-and-operators-in-python">回答</a> 讨论了为什么 Python 中缺少增量和减量运算符.</li>
</ul>
</li>
<li>
<p>Python 使用 2 个字节存储函数中的本地变量. 理论上, 这意味着函数中只能定义 65536 个变量. 但是，Python 内置了一个方便的解决方案，可用于存储超过 2^16 个变量名. 下面的代码演示了当定义了超过 65536 个局部变量时堆栈中发生的情况 (警告: 这段代码会打印大约 2^18 行文本, 请做好准备!):</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">def f():</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> + <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.join([<span class="string">&quot;X&quot;</span>+<span class="built_in">str</span>(x)+<span class="string">&quot;=&quot;</span> + <span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65539</span>)]))</span><br><span class="line"></span><br><span class="line">f()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dis.dis(f))</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>你的 <em>Python 代码</em> 并不会多线程同时运行 (是的, 你没听错!). 虽然你觉得会产生多个线程并让它们同时执行你的代码, 但是, 由于 <a target="_blank" rel="noopener" href="https://wiki.python.org/moin/GlobalInterpreterLock">全局解释锁</a>的存在, 你所做的只是让你的线程依次在同一个核心上执行. Python 多线程适用于 IO 密集型的任务, 但如果想要并行处理 CPU 密集型的任务, 你应该会想使用 <a target="_blank" rel="noopener" href="https://docs.python.org/2/library/multiprocessing.html">multiprocessing</a> 模块.</p>
</li>
<li>
<p>列表切片超出索引边界而不引发任何错误</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>some_list[<span class="number">111</span>:]</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>int('١٢٣٤٥٦٧٨٩')</code> 在 Python 3 中会返回 <code>123456789</code>. 在 Python 中, 十进制字符包括数字字符, 以及可用于形成十进制数字的所有字符, 例如: U+0660, ARABIC-INDIC DIGIT ZERO. 这有一个关于此的 <a target="_blank" rel="noopener" href="http://chris.improbable.org/2014/8/25/adventures-in-unicode-digits/">有趣故事</a>.</p>
</li>
<li>
<p><code>'abc'.count('') == 4</code>. 这有一个 <code>count</code> 方法的相近实现, 能更好的说明问题</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">count</span>(<span class="params">s, sub</span>):</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) + <span class="number">1</span> - <span class="built_in">len</span>(sub)):</span><br><span class="line">        result += (s[i:i + <span class="built_in">len</span>(sub)] == sub)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>这个行为是由于空子串(<code>''</code>)与原始字符串中长度为 0 的切片相匹配导致的.</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>What the f*ck Python!</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/satwikkansal/wtfpython">https://github.com/satwikkansal/wtfpython</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>satwikkansal</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2021-08-20</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2022-08-19</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a></div><div class="post_share"><div class="social-share" data-image="https://static.emoryhuang.cn/webp/4290553642-banner.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://static.emoryhuang.cn/webp/emoryhuang-wechat.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/emoryhuang-wechat.webp" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://static.emoryhuang.cn/webp/emoryhuang-alipay.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/emoryhuang-alipay.webp" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/blog/1639121736.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/1639121736-banner.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">PyTorch 学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/blog/2092262605.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/2092262605-banner.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">正则表达式学习笔记</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Twikoo</span><span class="switch-btn"></span><span class="second-comment">Valine</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/img/emoryhuang-avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">EmoryHuang</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">122</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">103</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/EmoryHuang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/EmoryHuang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:boyi_huang@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome to my Blog!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">What the f*ck Python!</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-33"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">Structure of the Examples&#x2F;示例结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%B2%BE%E9%80%89%E7%9A%84%E6%A0%87%E9%A2%98"><span class="toc-number">2.0.1.</span> <span class="toc-text">&gt; 一个精选的标题 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Usage&#x2F;用法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">👀 Examples&#x2F;示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Section-Strain-your-brain-%E5%A4%A7%E8%84%91%E8%BF%90%E5%8A%A8"><span class="toc-number">4.1.</span> <span class="toc-text">Section: Strain your brain!&#x2F;大脑运动!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Strings-can-be-tricky-sometimes-%E5%BE%AE%E5%A6%99%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.1.1.</span> <span class="toc-text">&gt; Strings can be tricky sometimes&#x2F;微妙的字符串 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-2"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Time-for-some-hash-brownies-%E6%98%AF%E6%97%B6%E5%80%99%E6%9D%A5%E7%82%B9%E8%9B%8B%E7%B3%95%E4%BA%86"><span class="toc-number">4.1.2.</span> <span class="toc-text">&gt; Time for some hash brownies!&#x2F;是时候来点蛋糕了!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-3"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Return-return-everywhere-%E5%88%B0%E5%A4%84%E8%BF%94%E5%9B%9E%EF%BC%81"><span class="toc-number">4.1.3.</span> <span class="toc-text">&gt; Return return everywhere!&#x2F;到处返回！</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-4"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deep-down-we%E2%80%99re-all-the-same-%E6%9C%AC%E8%B4%A8%E4%B8%8A-%E6%88%91%E4%BB%AC%E9%83%BD%E4%B8%80%E6%A0%B7"><span class="toc-number">4.1.4.</span> <span class="toc-text">&gt; Deep down, we’re all the same.&#x2F;本质上,我们都一样. *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-5"><span class="toc-number">4.1.4.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#For-what-%E4%B8%BA%E4%BB%80%E4%B9%88"><span class="toc-number">4.1.5.</span> <span class="toc-text">&gt; For what?&#x2F;为什么?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-6"><span class="toc-number">4.1.5.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Evaluation-time-discrepancy-%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA%E5%B7%AE%E5%BC%82"><span class="toc-number">4.1.6.</span> <span class="toc-text">&gt; Evaluation time discrepancy&#x2F;执行时机差异</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-7"><span class="toc-number">4.1.6.1.</span> <span class="toc-text">💡 说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-is-not-what-it-is-%E5%87%BA%E4%BA%BA%E6%84%8F%E6%96%99%E7%9A%84is"><span class="toc-number">4.1.7.</span> <span class="toc-text">&gt; is is not what it is!&#x2F;出人意料的is!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-8"><span class="toc-number">4.1.7.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-tic-tac-toe-where-X-wins-in-the-first-attempt-%E4%B8%80%E8%B9%B4%E5%8D%B3%E8%87%B3"><span class="toc-number">4.1.8.</span> <span class="toc-text">&gt; A tic-tac-toe where X wins in the first attempt!&#x2F;一蹴即至!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-9"><span class="toc-number">4.1.8.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-sticky-output-function-%E9%BA%BB%E7%83%A6%E7%9A%84%E8%BE%93%E5%87%BA"><span class="toc-number">4.1.9.</span> <span class="toc-text">&gt; The sticky output function&#x2F;麻烦的输出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-10"><span class="toc-number">4.1.9.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-not-is-not-is-not-is-not-%E4%B8%8D%E6%98%AF-is-not"><span class="toc-number">4.1.10.</span> <span class="toc-text">&gt; is not ... is not is (not ...)&#x2F;is not ... 不是 is (not ...)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-11"><span class="toc-number">4.1.10.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-surprising-comma-%E6%84%8F%E5%A4%96%E7%9A%84%E9%80%97%E5%8F%B7"><span class="toc-number">4.1.11.</span> <span class="toc-text">&gt; The surprising comma&#x2F;意外的逗号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-12"><span class="toc-number">4.1.11.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Backslashes-at-the-end-of-string-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9C%AB%E5%B0%BE%E7%9A%84%E5%8F%8D%E6%96%9C%E6%9D%A0"><span class="toc-number">4.1.12.</span> <span class="toc-text">&gt; Backslashes at the end of string&#x2F;字符串末尾的反斜杠</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-13"><span class="toc-number">4.1.12.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#not-knot-%E5%88%AB%E7%BA%A0%E7%BB%93"><span class="toc-number">4.1.13.</span> <span class="toc-text">&gt; not knot!&#x2F;别纠结!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-14"><span class="toc-number">4.1.13.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Half-triple-quoted-strings-%E4%B8%89%E4%B8%AA%E5%BC%95%E5%8F%B7"><span class="toc-number">4.1.14.</span> <span class="toc-text">&gt; Half triple-quoted strings&#x2F;三个引号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-15"><span class="toc-number">4.1.14.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Midnight-time-doesn%E2%80%99t-exist-%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%8D%88%E5%A4%9C"><span class="toc-number">4.1.15.</span> <span class="toc-text">&gt; Midnight time doesn’t exist?&#x2F;不存在的午夜?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-16"><span class="toc-number">4.1.15.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What%E2%80%99s-wrong-with-booleans-%E5%B8%83%E5%B0%94%E4%BD%A0%E5%92%8B%E4%BA%86"><span class="toc-number">4.1.16.</span> <span class="toc-text">&gt; What’s wrong with booleans?&#x2F;布尔你咋了?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-17"><span class="toc-number">4.1.16.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class-attributes-and-instance-attributes-%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">4.1.17.</span> <span class="toc-text">&gt; Class attributes and instance attributes&#x2F;类属性和实例属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-18"><span class="toc-number">4.1.17.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yielding-None-%E7%94%9F%E6%88%90-None"><span class="toc-number">4.1.18.</span> <span class="toc-text">&gt; yielding None&#x2F;生成 None</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-19"><span class="toc-number">4.1.18.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mutating-the-immutable-%E5%BC%BA%E4%BA%BA%E6%89%80%E9%9A%BE"><span class="toc-number">4.1.19.</span> <span class="toc-text">&gt; Mutating the immutable!&#x2F;强人所难</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-20"><span class="toc-number">4.1.19.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-disappearing-variable-from-outer-scope-%E6%B6%88%E5%A4%B1%E7%9A%84%E5%A4%96%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-number">4.1.20.</span> <span class="toc-text">&gt; The disappearing variable from outer scope&#x2F;消失的外部变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-21"><span class="toc-number">4.1.20.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#When-True-is-actually-False-%E7%9C%9F%E4%BA%A6%E5%81%87"><span class="toc-number">4.1.21.</span> <span class="toc-text">&gt; When True is actually False&#x2F;真亦假</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-22"><span class="toc-number">4.1.21.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#From-filled-to-None-in-one-instruction%E2%80%A6-%E4%BB%8E%E6%9C%89%E5%88%B0%E6%97%A0%E2%80%A6"><span class="toc-number">4.1.22.</span> <span class="toc-text">&gt; From filled to None in one instruction…&#x2F;从有到无…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-23"><span class="toc-number">4.1.22.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subclass-relationships-%E5%AD%90%E7%B1%BB%E5%85%B3%E7%B3%BB"><span class="toc-number">4.1.23.</span> <span class="toc-text">&gt; Subclass relationships&#x2F;子类关系 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-24"><span class="toc-number">4.1.23.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-mysterious-key-type-conversion-%E7%A5%9E%E7%A7%98%E7%9A%84%E9%94%AE%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.1.24.</span> <span class="toc-text">&gt; The mysterious key type conversion&#x2F;神秘的键型转换 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-25"><span class="toc-number">4.1.24.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Let%E2%80%99s-see-if-you-can-guess-this-%E7%9C%8B%E7%9C%8B%E4%BD%A0%E8%83%BD%E5%90%A6%E7%8C%9C%E5%88%B0%E8%BF%99%E4%B8%80%E7%82%B9"><span class="toc-number">4.1.25.</span> <span class="toc-text">&gt; Let’s see if you can guess this?&#x2F;看看你能否猜到这一点?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-26"><span class="toc-number">4.1.25.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Section-Appearances-are-deceptive-%E5%A4%96%E8%A1%A8%E6%98%AF%E9%9D%A0%E4%B8%8D%E4%BD%8F%E7%9A%84"><span class="toc-number">4.2.</span> <span class="toc-text">Section: Appearances are deceptive!&#x2F;外表是靠不住的!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Skipping-lines-%E8%B7%B3%E8%BF%87%E4%B8%80%E8%A1%8C"><span class="toc-number">4.2.1.</span> <span class="toc-text">&gt; Skipping lines?&#x2F;跳过一行?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-27"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Teleportation-%E7%A9%BA%E9%97%B4%E7%A7%BB%E5%8A%A8"><span class="toc-number">4.2.2.</span> <span class="toc-text">&gt; Teleportation&#x2F;空间移动 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-28"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Well-something-is-fishy%E2%80%A6-%E5%97%AF%EF%BC%8C%E6%9C%89%E4%BA%9B%E5%8F%AF%E7%96%91%E2%80%A6"><span class="toc-number">4.2.3.</span> <span class="toc-text">&gt; Well, something is fishy…&#x2F;嗯，有些可疑…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-29"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Section-Watch-out-for-the-landmines-%E5%B0%8F%E5%BF%83%E5%9C%B0%E9%9B%B7"><span class="toc-number">4.3.</span> <span class="toc-text">Section: Watch out for the landmines!&#x2F;小心地雷!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Modifying-a-dictionary-while-iterating-over-it-%E8%BF%AD%E4%BB%A3%E5%AD%97%E5%85%B8%E6%97%B6%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">4.3.1.</span> <span class="toc-text">&gt; Modifying a dictionary while iterating over it&#x2F;迭代字典时的修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-30"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stubborn-del-operator-%E5%9D%9A%E5%BC%BA%E7%9A%84-del"><span class="toc-number">4.3.2.</span> <span class="toc-text">&gt; Stubborn del operator&#x2F;坚强的 del *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-31"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deleting-a-list-item-while-iterating-%E8%BF%AD%E4%BB%A3%E5%88%97%E8%A1%A8%E6%97%B6%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0"><span class="toc-number">4.3.3.</span> <span class="toc-text">&gt; Deleting a list item while iterating&#x2F;迭代列表时删除元素</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-32"><span class="toc-number">4.3.3.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Loop-variables-leaking-out-%E5%BE%AA%E7%8E%AF%E5%8F%98%E9%87%8F%E6%B3%84%E6%BC%8F"><span class="toc-number">4.3.4.</span> <span class="toc-text">&gt; Loop variables leaking out!&#x2F;循环变量泄漏!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-33"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Beware-of-default-mutable-arguments-%E5%BD%93%E5%BF%83%E9%BB%98%E8%AE%A4%E7%9A%84%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0"><span class="toc-number">4.3.5.</span> <span class="toc-text">&gt; Beware of default mutable arguments!&#x2F;当心默认的可变参数!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-34"><span class="toc-number">4.3.5.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Catching-the-Exceptions-%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8"><span class="toc-number">4.3.6.</span> <span class="toc-text">&gt; Catching the Exceptions&#x2F;捕获异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-35"><span class="toc-number">4.3.6.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Same-operands-different-story-%E5%90%8C%E4%BA%BA%E4%B8%8D%E5%90%8C%E5%91%BD"><span class="toc-number">4.3.7.</span> <span class="toc-text">&gt; Same operands, different story!&#x2F;同人不同命!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-36"><span class="toc-number">4.3.7.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-out-of-scope-variable-%E5%A4%96%E9%83%A8%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%8F%98%E9%87%8F"><span class="toc-number">4.3.8.</span> <span class="toc-text">&gt; The out of scope variable&#x2F;外部作用域变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-37"><span class="toc-number">4.3.8.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Be-careful-with-chained-operations-%E5%B0%8F%E5%BF%83%E9%93%BE%E5%BC%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.9.</span> <span class="toc-text">&gt; Be careful with chained operations&#x2F;小心链式操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-38"><span class="toc-number">4.3.9.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Name-resolution-ignoring-class-scope-%E5%BF%BD%E7%95%A5%E7%B1%BB%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%9A%84%E5%90%8D%E7%A7%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">4.3.10.</span> <span class="toc-text">&gt; Name resolution ignoring class scope&#x2F;忽略类作用域的名称解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-39"><span class="toc-number">4.3.10.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Needle-in-a-Haystack-%E5%A4%A7%E6%B5%B7%E6%8D%9E%E9%92%88"><span class="toc-number">4.3.11.</span> <span class="toc-text">&gt; Needle in a Haystack&#x2F;大海捞针</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-40"><span class="toc-number">4.3.11.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Section-The-Hidden-treasures-%E9%9A%90%E8%97%8F%E7%9A%84%E5%AE%9D%E8%97%8F"><span class="toc-number">4.4.</span> <span class="toc-text">Section: The Hidden treasures!&#x2F;隐藏的宝藏!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Okay-Python-Can-you-make-me-fly-Python-%E5%8F%AF%E5%90%A6%E5%B8%A6%E6%88%91%E9%A3%9E"><span class="toc-number">4.4.1.</span> <span class="toc-text">&gt; Okay Python, Can you make me fly?&#x2F;Python, 可否带我飞? *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-41"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#goto-but-why-goto-%E4%BD%86%E4%B8%BA%E4%BB%80%E4%B9%88"><span class="toc-number">4.4.2.</span> <span class="toc-text">&gt; goto, but why?&#x2F;goto, 但为什么? *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-42"><span class="toc-number">4.4.2.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Brace-yourself-%E5%81%9A%E5%A5%BD%E6%80%9D%E6%83%B3%E5%87%86%E5%A4%87"><span class="toc-number">4.4.3.</span> <span class="toc-text">&gt; Brace yourself!&#x2F;做好思想准备 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-43"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Let%E2%80%99s-meet-Friendly-Language-Uncle-For-Life-%E8%AE%A9%E7%94%9F%E6%B4%BB%E6%9B%B4%E5%8F%8B%E5%A5%BD"><span class="toc-number">4.4.4.</span> <span class="toc-text">&gt; Let’s meet Friendly Language Uncle For Life&#x2F;让生活更友好 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-44"><span class="toc-number">4.4.4.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Even-Python-understands-that-love-is-complicated-%E8%BF%9E-Python-%E4%B9%9F%E7%9F%A5%E9%81%93%E7%88%B1%E6%98%AF%E9%9A%BE%E8%A8%80%E7%9A%84"><span class="toc-number">4.4.5.</span> <span class="toc-text">&gt; Even Python understands that love is complicated&#x2F;连 Python 也知道爱是难言的 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-45"><span class="toc-number">4.4.5.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Yes-it-exists-%E6%98%AF%E7%9A%84-%E5%AE%83%E5%AD%98%E5%9C%A8"><span class="toc-number">4.4.6.</span> <span class="toc-text">&gt; Yes, it exists!&#x2F;是的, 它存在!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-46"><span class="toc-number">4.4.6.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inpinity-%E6%97%A0%E9%99%90"><span class="toc-number">4.4.7.</span> <span class="toc-text">&gt; Inpinity&#x2F;无限 *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-47"><span class="toc-number">4.4.7.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mangling-time-%E4%BF%AE%E9%A5%B0%E6%97%B6%E9%97%B4"><span class="toc-number">4.4.8.</span> <span class="toc-text">&gt; Mangling time!&#x2F;修饰时间! *</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-48"><span class="toc-number">4.4.8.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Section-Miscellaneous-%E6%9D%82%E9%A1%B9"><span class="toc-number">4.5.</span> <span class="toc-text">Section: Miscellaneous&#x2F;杂项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#is-faster-%E6%9B%B4%E5%BF%AB%E7%9A%84"><span class="toc-number">4.5.1.</span> <span class="toc-text">&gt; +&#x3D; is faster&#x2F;更快的 +&#x3D;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-49"><span class="toc-number">4.5.1.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Let%E2%80%99s-make-a-giant-string-%E6%9D%A5%E5%81%9A%E4%B8%AA%E5%B7%A8%E5%A4%A7%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%A7%EF%BC%81"><span class="toc-number">4.5.2.</span> <span class="toc-text">&gt; Let’s make a giant string!&#x2F;来做个巨大的字符串吧！</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-50"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Explicit-typecast-of-strings-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%98%BE%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.5.3.</span> <span class="toc-text">&gt; Explicit typecast of strings&#x2F;字符串的显式类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%92%A1-%E8%AF%B4%E6%98%8E-51"><span class="toc-number">4.5.3.1.</span> <span class="toc-text">💡 说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Minor-Ones-%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">4.5.4.</span> <span class="toc-text">&gt; Minor Ones&#x2F;小知识点</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/blog/683141325.html" title="使用 PyG 进行图神经网络训练"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/683141325-banner.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 PyG 进行图神经网络训练"/></a><div class="content"><a class="title" href="/blog/683141325.html" title="使用 PyG 进行图神经网络训练">使用 PyG 进行图神经网络训练</a><time datetime="2022-11-09T03:12:05.000Z" title="发表于 2022-11-09 11:12:05">2022-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/1329760803.html" title="【论文阅读】ST-PIL: Spatial-Temporal Periodic Interest Learning for Next Point-of-Interest Recommendation"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/1329760803-banner.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【论文阅读】ST-PIL: Spatial-Temporal Periodic Interest Learning for Next Point-of-Interest Recommendation"/></a><div class="content"><a class="title" href="/blog/1329760803.html" title="【论文阅读】ST-PIL: Spatial-Temporal Periodic Interest Learning for Next Point-of-Interest Recommendation">【论文阅读】ST-PIL: Spatial-Temporal Periodic Interest Learning for Next Point-of-Interest Recommendation</a><time datetime="2022-10-10T03:16:56.000Z" title="发表于 2022-10-10 11:16:56">2022-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2631345981.html" title="【论文阅读】Next point-of-interest recommendation with auto-correlation enhanced
 multi-modal transformer network"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/2631345981-banner.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【论文阅读】Next point-of-interest recommendation with auto-correlation enhanced
 multi-modal transformer network"/></a><div class="content"><a class="title" href="/blog/2631345981.html" title="【论文阅读】Next point-of-interest recommendation with auto-correlation enhanced
 multi-modal transformer network">【论文阅读】Next point-of-interest recommendation with auto-correlation enhanced
 multi-modal transformer network</a><time datetime="2022-10-08T07:10:43.000Z" title="发表于 2022-10-08 15:10:43">2022-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/4203594080.html" title="【论文阅读】Empowering next POI recommendation with multi-relational modeling"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/4203594080-banner.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【论文阅读】Empowering next POI recommendation with multi-relational modeling"/></a><div class="content"><a class="title" href="/blog/4203594080.html" title="【论文阅读】Empowering next POI recommendation with multi-relational modeling">【论文阅读】Empowering next POI recommendation with multi-relational modeling</a><time datetime="2022-09-27T05:40:43.000Z" title="发表于 2022-09-27 13:40:43">2022-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/362082315.html" title="【论文阅读】Hierarchical multi-task graph recurrent network for next POI recommendation"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static.emoryhuang.cn/webp/362082315-banner.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【论文阅读】Hierarchical multi-task graph recurrent network for next POI recommendation"/></a><div class="content"><a class="title" href="/blog/362082315.html" title="【论文阅读】Hierarchical multi-task graph recurrent network for next POI recommendation">【论文阅读】Hierarchical multi-task graph recurrent network for next POI recommendation</a><time datetime="2022-09-18T07:28:00.000Z" title="发表于 2022-09-18 15:28:00">2022-09-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://static.emoryhuang.cn/webp/4290553642-banner.webp')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By EmoryHuang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="https://icp.gov.moe" target="_blank">萌ICP备 </a><a href="https://icp.gov.moe/?keyword=20215281" target="_blank"> 20215281号</a> | <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备2022000821号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000)
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.emoryhuang.cn/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.emoryhuang.cn/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo@1/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'bcNDuLTWy0iRRePdlkOpKSve-gzGzoHsz',
      appKey: 'yTSKpRCVBDa8gyFQLEuSp0B2',
      avatar: 'monsterid',
      serverURLs: 'https://bcndultw.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Twikoo' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script><script async src="/js/grayscale.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-8PVDZZ1XD2', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://github-calendar-api-emoryhuang.vercel.app/api?emoryhuang";
            var git_color =['#ebedf0', '#f0fff4', '#dcffe4', '#bef5cb', '#85e89d', '#34d058', '#28a745', '#22863a', '#176f2c', '#165c26', '#144620'];
            var git_user ="emoryhuang";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>